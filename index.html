<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>熊猫在路上</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="熊猫在路上">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="熊猫在路上">
<meta property="og:locale" content="ch">
<meta property="article:author" content="熊猫在路上">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="熊猫在路上" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">熊猫在路上</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-第四周/1.9" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.9/" class="article-date">
  <time datetime="2020-01-19T06:07:45.929Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.9/">第四周/1.9</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="取证分析"><a href="#取证分析" class="headerlink" title="取证分析"></a>取证分析</h1><h2 id="ios镜像转vm虚拟机"><a href="#ios镜像转vm虚拟机" class="headerlink" title="ios镜像转vm虚拟机"></a>ios镜像转vm虚拟机</h2><p>工具</p>
<h2 id="虚拟机打开"><a href="#虚拟机打开" class="headerlink" title="虚拟机打开"></a>虚拟机打开</h2><p>删除多余设备（打印机、声卡等）</p>
<p>可能存在网卡驱动异常</p>
<p>安装vmtools</p>
<p>通过PE安装</p>
<p>加载PE镜像</p>
<p>BIOS修改启动配置</p>
<p>破解开机密码</p>
<h2 id="获取主机信息"><a href="#获取主机信息" class="headerlink" title="获取主机信息"></a>获取主机信息</h2><p>进入vm虚拟机</p>
<p>基本信息获取</p>
<p>脚本跑</p>
<p>检查异常</p>
<blockquote>
<p><a href="https://www.processlibrary.com/" target="_blank" rel="noopener">https://www.processlibrary.com/</a></p>
<p><a href="https://www.file.net/" target="_blank" rel="noopener">https://www.file.net/</a></p>
<p>查看进程名称网站，罗列</p>
</blockquote>
<p>开启抓包，查看请求DNS</p>
<h1 id="知识补充"><a href="#知识补充" class="headerlink" title="知识补充"></a>知识补充</h1><h2 id="DNS关键词"><a href="#DNS关键词" class="headerlink" title="DNS关键词"></a>DNS关键词</h2><p><strong>什么是DNS？DNS域名称空间的组织方式？DNS服务的工作过程</strong></p>
<p><strong>A记录、CNAME记录、MX记录、PTR记录</strong></p>
<blockquote>
<p><a href="https://blog.csdn.net/guowenyan001/article/details/9330669" target="_blank" rel="noopener">https://blog.csdn.net/guowenyan001/article/details/9330669</a></p>
</blockquote>
<h2 id="DNS-SOA记录"><a href="#DNS-SOA记录" class="headerlink" title="DNS SOA记录"></a>DNS SOA记录</h2><p><strong>DNS关键词：SOA记录、NS记录</strong></p>
<blockquote>
<p><a href="http://bbs.51cto.com/thread-908637-1.html" target="_blank" rel="noopener">http://bbs.51cto.com/thread-908637-1.html</a></p>
</blockquote>
<h2 id="个人小结"><a href="#个人小结" class="headerlink" title="个人小结"></a>个人小结</h2><h3 id="DNS的一些基本概念"><a href="#DNS的一些基本概念" class="headerlink" title="DNS的一些基本概念"></a>DNS的一些基本概念</h3><p>根域–顶级域–第二层域（注册域名）–子域–主机名</p>
<h3 id="DNS域名的常见种类"><a href="#DNS域名的常见种类" class="headerlink" title="DNS域名的常见种类"></a>DNS域名的常见种类</h3><p>com、edu、net、gov等待</p>
<h3 id="资源记录–RR"><a href="#资源记录–RR" class="headerlink" title="资源记录–RR"></a>资源记录–RR</h3><p>DNS 数据库中包含的资源记录 (RR)。 每个 RR 标识数据库中的特定资源。我们在建立DNS服务器时，经常会用到SOA,NS,A之类的记录，在维护DNS服务器时，会用到MX，CNAME记录。</p>
<p>SOA</p>
<p>A</p>
<p>NS</p>
<p>MX</p>
<p>CNAME</p>
<h3 id="关于SOA记录"><a href="#关于SOA记录" class="headerlink" title="关于SOA记录"></a>关于SOA记录</h3><p>SOA记录表明了DNS服务器之间的关系。SOA记录表明了谁是这个区域的所有者。</p>
<p>一个DNS服务器安装后，需要创建一个区域，以后这个区域的查询解析，都是通过DNS服务器来完成的。现在来说一下所有者，我这里所说的所有者，就是谁对这个区域有修改权利。常见的DNS服务器只能创建一个标准区域，然后可以创建很多个辅助区域。标准区域是可以读写修改的。而辅助区域只能通过标准区域复制来完成，不能在辅助区域中进行修改。而创建标准区域的DNS就会有SOA记录，或者准确说SOA记录中的主机地址一定是这个标准区域的服务器IP地址。</p>
<ul>
<li><p>NS记录表示域名服务器记录，用来指定该域名由哪个DNS服务器来进行解析</p>
</li>
<li><p>SOA记录设置一些数据版本和更新以及过期时间的信息</p>
</li>
</ul>
<p>明天要去了解事件IP</p>
<p>对那个镜像进行分析</p>
<p>查看日志中可疑服务的启动</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.9/" data-id="ck5na8rty0008g4tw7mx4a9l2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第四周/1.8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.8/" class="article-date">
  <time datetime="2020-01-19T06:07:45.919Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.8/">第四周/1.8</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="freebuf"><a href="#freebuf" class="headerlink" title="freebuf"></a>freebuf</h1><h2 id="00空字节"><a href="#00空字节" class="headerlink" title="%00空字节"></a>%00空字节</h2><blockquote>
<p><a href="https://www.freebuf.com/vuls/224088.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/224088.html</a></p>
</blockquote>
<p>注册机制，带入%00，爆出更多信息</p>
<h1 id="工作内容"><a href="#工作内容" class="headerlink" title="工作内容"></a>工作内容</h1><h2 id="全息分析"><a href="#全息分析" class="headerlink" title="全息分析"></a>全息分析</h2><p>天津攻击溯源</p>
<p>昨天晚上对每个http协议进行分析</p>
<p>记录了访问过的页面</p>
<p>其中邮件系统</p>
<p>登陆成功，还原查看邮件的部分内容</p>
<p>晚上学习的是全息平台的流量分析思路</p>
<h3 id="木马通信的流量特征"><a href="#木马通信的流量特征" class="headerlink" title="木马通信的流量特征"></a>木马通信的流量特征</h3><p>基于木马通信的整个过程，着重于体现在流量上的特点</p>
<ul>
<li><p>dns请求IP，主机连接IP</p>
<ul>
<li><p>会产生：DNS会话请求，而且是主机发起的周期性请求，可以通过（聚合分析 会话数量）着重查看频繁且数据交换大的流量来分析DNS协议；</p>
</li>
<li><p>还会产生：TCP会话请求（包括HTTP等），体现在主机连接IP，可以通过分析负载（聚合分析 会话IP）查看频繁交互的源IP和目的IP</p>
</li>
</ul>
</li>
<li><p>主动连接IP</p>
</li>
<li><p>大致同上 </p>
</li>
<li><p>监听端口，等待连接</p>
<ul>
<li>会产生：未知IP 连接 内网IP（固定端口）</li>
</ul>
</li>
</ul>
<h3 id="知识面"><a href="#知识面" class="headerlink" title="知识面"></a>知识面</h3><p>DGA域名变换</p>
<p>DNS递归</p>
<p>DNS soa记录</p>
<p>IPC内网渗透</p>
<p>smb协议</p>
<h3 id="入手点"><a href="#入手点" class="headerlink" title="入手点"></a>入手点</h3><p>特征IP、域名、高危端口</p>
<h2 id="取证分析"><a href="#取证分析" class="headerlink" title="取证分析"></a>取证分析</h2><p>分为取和分析</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.8/" data-id="ck5na8rtx0007g4tw7fdkd4tj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第四周/1.7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.7/" class="article-date">
  <time datetime="2020-01-19T06:07:45.899Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.7/">第四周/1.7</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="freebuf"><a href="#freebuf" class="headerlink" title="freebuf"></a>freebuf</h1><h2 id="浅析前端加密后数据包的修改方法"><a href="#浅析前端加密后数据包的修改方法" class="headerlink" title="浅析前端加密后数据包的修改方法"></a>浅析前端加密后数据包的修改方法</h2><blockquote>
<p><a href="https://www.freebuf.com/articles/web/223011.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/223011.html</a></p>
</blockquote>
<p>要做到对前端加密数据的修改，有两种思路：</p>
<blockquote>
<p>（1）从网站的前端JS代码中查找加密函数，有些站点的加密方式较为简单，通过审计前端JS逻辑代码可以直接破解，从而对密文进行解密后做修改，最后再重新加密并发送；</p>
<p>（2）中断程序的执行，直接在前端JS代码对明文数据进行加密前，对明文数据进行更改。</p>
</blockquote>
<p>显然，第二种思路更具有通用性</p>
<p>前端断点拦截</p>
<p>​    借助F12开发者工具的断点调试功能，我们成功实现了对采用前端加密的站点的数据包篡改。</p>
<p>JS脚本替换</p>
<p>​    借助Fiddler抓包工具，实现对前端加密站点的JS脚本替换，从而达到任意篡改数据包的目的,打开Fiddler，捕获加密函数所在的JS文件的请求，并将其拖入到右侧AutoResponder模块里勾选以下选项并添加自动替换规则，将本地编辑的JS代码替换用于在线加密的JS代码刷新该站点，点击该功能模块，其前端JS代码将被我们本地编辑过的JS代码替换</p>
<p>总结<br>本文讲述的两种方法，断点调试虽然比JS脚本代码替换简便，但是JS脚本代码替换的方法可以实现的功能更为强大，测试人员可根据实际的需求，选择合适的测试方法。</p>
<h1 id="Windows取证分析部分总结思路"><a href="#Windows取证分析部分总结思路" class="headerlink" title="Windows取证分析部分总结思路"></a>Windows取证分析部分总结思路</h1><h2 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h2><p>apateDNS(DNS劫持)</p>
<p>Autoruns(启动项)</p>
<p>cports(端口查看)</p>
<p>Dumplt(磁盘)</p>
<p>PCHunter</p>
<p>PowerTool</p>
<p>WinHex</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ul>
<li>首先要确认是否存在异常</li>
<li>初步查看启动项、高危端口、不常见进程、可疑图标</li>
<li>然后可以利用apateDNS判断分析，查看新增的端口或进程</li>
<li>锁定可疑进程，并查看进程模块和线程</li>
<li>模块关注数字签名、线程关注是否有对应的模块</li>
<li>最后追踪到文件，找出驻留文件、以及启动方式、证书的证据</li>
</ul>
<h1 id="全息流量分析"><a href="#全息流量分析" class="headerlink" title="全息流量分析"></a>全息流量分析</h1><h2 id="大致思路"><a href="#大致思路" class="headerlink" title="大致思路"></a>大致思路</h2><p>大体查看异常</p>
<p>着重分析HTTP流量</p>
<p>分析上下文</p>
<p>找出联系</p>
<h1 id="关于渗透"><a href="#关于渗透" class="headerlink" title="关于渗透"></a>关于渗透</h1><h2 id="域渗透"><a href="#域渗透" class="headerlink" title="域渗透"></a>域渗透</h2><p><strong>还没看</strong></p>
<blockquote>
<p><a href="https://www.anquanke.com/post/id/92646" target="_blank" rel="noopener">https://www.anquanke.com/post/id/92646</a></p>
<p><a href="https://www.secpulse.com/archives/40497.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/40497.html</a></p>
<p><a href="https://www.freebuf.com/articles/system/197160.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/system/197160.html</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.7/" data-id="ck5na8rtw0006g4twdexfhxxv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第四周/1.6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.6/" class="article-date">
  <time datetime="2020-01-19T06:07:45.874Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.6/">第四周/1.6</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="挖洞经验-关于密码重置"><a href="#挖洞经验-关于密码重置" class="headerlink" title="挖洞经验-关于密码重置"></a>挖洞经验-关于密码重置</h1><p>freebuf早报</p>
<blockquote>
<p><a href="https://www.freebuf.com/vuls/223882.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/223882.html</a></p>
</blockquote>
<p><strong>在重置密码请求发包中添加X-Forwarded-Host主机信息</strong></p>
<h2 id="发现过程"><a href="#发现过程" class="headerlink" title="发现过程"></a>发现过程</h2><p>所需工具：BurpSuite、Ngrok Server。Ngrok服务可以将自己本地PC映射到云上的Server公网，目的为将本地PC变成与外部网络交流的终端服务器，间接把云上的Server则变成外网与内网PC之间的中转代理。</p>
<p>1、访问目标网站的忘记密码功能，在其中输入用户名信息请求获得重置密码链接：<a href="https://redacted.com/users/forgot_password，Notice：之后目标网站会往你的注册邮箱发送一个重置密码链接。" target="_blank" rel="noopener">https://redacted.com/users/forgot_password，Notice：之后目标网站会往你的注册邮箱发送一个重置密码链接。</a></p>
<p>2、在上过程中，用BurpSuite开启Web抓包，请求包情况如下：</p>
<p><a href="https://image.3001.net/images/20191225/1577269993_5e033ae95c2a7.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20191225/1577269993_5e033ae95c2a7.png!small" alt="img"></a></p>
<p>从中我们添加一个X-Forwarded-Host: bing.com来尝试，看看目标网站是否会把这个重置密码链接包含进bing.com；</p>
<blockquote>
<p>X-Forwarded-For（XFF）是用来识别通过HTTP代理或负载均衡方式连接到Web服务器的客户端最原始的IP地址的HTTP请求头字段。 Squid 缓存代理服务器的开发人员最早引入了这一HTTP头字段，并由IETF在HTTP头字段标准化草案[1]中正式提出。具体<a href="https://www.keycdn.com/support/x-forwarded-host" target="_blank" rel="noopener">点此处</a>参考。</p>
</blockquote>
<p>3、这里，我们打开邮箱，查看目标网站发送过来的密码重置链接长啥样，哇，从发来的邮件中我们可以看到，其中包含了用户Token信息的密码重置链接，大致样子如下：</p>
<p><a href="https://bing.com/users/reset_password/tqo4Xciu806oiR1FjX8RtIUc1DTcm1B5Kqb53j1fLEkzMW2GPgCpuEODDStpRaES" target="_blank" rel="noopener">https://bing.com/users/reset_password/tqo4Xciu806oiR1FjX8RtIUc1DTcm1B5Kqb53j1fLEkzMW2GPgCpuEODDStpRaES</a></p>
<p><a href="https://image.3001.net/images/20191225/1577270068_5e033b3441452.jpeg" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20191225/1577270068_5e033b3441452.jpeg!small" alt="img"></a></p>
<p>就这样，我们可以认为我的密码重置Token信息已经转发给bing.com了，这里需要对这个Token做个真实验证，所以，我们可以把密码重置链接中的<a href="https://bing.com/" target="_blank" rel="noopener">https://bing.com</a>替换成目标网站的<a href="https://redacted.com/" target="_blank" rel="noopener">https://redacted.com</a>；</p>
<p>4、果然，我们打开了一个能真正实施重置密码的页面！</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>根据以上操作和存在的问题，我可以构造网络架构来劫持用户相关信息。步骤如下：</p>
<p>1、通过ngrok服务架设 Attacker服务器；</p>
<p>2、开启Burpsuite抓包，在目标网站的“忘记密码”处输入受害者用户名信息，执行密码重置确定操作；</p>
<p>3、在Burpsuite抓到的密码重置请求包中，添加Attacker服务器，格式如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-Host: ngrok.io</span><br></pre></td></tr></table></figure>

<p>其中ngrok.io为Attacker服务器的域名地址，如：</p>
<p><a href="https://image.3001.net/images/20191225/1577270112_5e033b6013153.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20191225/1577270112_5e033b6013153.png!small" alt="img"></a></p>
<p>4、 因此，当受害者邮箱收到目标网站发送的密码重置链接中就会包含Attacker服务器的域名地址，如：</p>
<blockquote>
<p><a href="http://ngrok.io/users/reset_password/tqo4Xciu806oiR1FjX8RtIUc1DTcm1B5Kqb53j1fLEkzMW2GPgCpuEODDStpRaES" target="_blank" rel="noopener">http://ngrok.io/users/reset_password/tqo4Xciu806oiR1FjX8RtIUc1DTcm1B5Kqb53j1fLEkzMW2GPgCpuEODDStpRaES</a></p>
</blockquote>
<p>当受害者一不小心点击了该链接之后，就会带着其用户密码重置Token去请求Attacker服务器ngrok.io（这里需要与用户的交互动作）；</p>
<p>5、在受害者点开上述链接的同时，在Attacker服务器ngrok.io这边，攻击者看到的将会是包含受害者用户密码重置Token的一个请求信息，如下：</p>
<p><a href="https://image.3001.net/images/20191225/1577270130_5e033b729caaf.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20191225/1577270130_5e033b729caaf.png!small" alt="img"></a></p>
<p>6、到此，攻击者获得了受害者用户的密码重置Token之后，把Attacker服务器ngrok.io替换成目标网站<a href="https://redacted.com/" target="_blank" rel="noopener">https://redacted.com</a>，加上后续的受害者用户的密码重置Token，就可成功对受害者账户的重置密码，实现对其账户的完全劫持。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">webshell连接工具分析</span><br><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;column&#x2F;223114.html</span><br><span class="line"></span><br><span class="line">挖洞SRC</span><br><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;vuls&#x2F;198327.html</span><br><span class="line"></span><br><span class="line">文件上传</span><br><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;223679.html</span><br></pre></td></tr></table></figure>



<h1 id="DNS隧道原理概述"><a href="#DNS隧道原理概述" class="headerlink" title="DNS隧道原理概述"></a>DNS隧道原理概述</h1><p>DNS隧道(DNS Tunneling)是将其他协议的内容封装在DNS协议中，然后以DNS请求和响应包完成传输数据(通信)的技术。当前网络世界中的DNS是一项必不可少的服务，所以防火墙和入侵检测设备处于可用性和用户友好的考虑将很难做到完全过滤掉DNS流量，因此，攻击者可以利用它实现诸如远程控制，文件传输等操作，众多研究表明DNS Tunneling在僵尸网络和APT攻击中扮演着至关重要的角色。</p>
<p>DNS隧道依据其实现方式大致可分为直连和中继两类。</p>
<p>直连：用户端直接和指定的目标DNS服务器建立连接，然后将需要传输的数据编码封装在DNS协议中进行通信。这种方式的优点是具有较高速度，但蔽性弱、易被探测追踪的缺点也很明显。另外直连方式的限制比较多，如目前很多的企业网络为了尽可能的降低遭受网络攻击的风险，一般将相关策略配置为仅允许与指定的可信任DNS服务器之间的流量通过。</p>
<p>中继隧道：通过DNS迭代查询而实现的中继DNS隧道，这种方式及其隐秘，且可在绝大部分场景下部署成功。但由于数据包到达目标DNS服务器前需要经过多个节点的跳转，数据传输速度和传输能力较直连会慢很多。</p>
<p>实现DNS隧道的关键要点：</p>
<p>(1)、规避DNS缓存机制</p>
<p>(2)、可利用DNS查询类型及其载荷编码</p>
<p>(3)、如何应道域名系统采用的C/S机制，即Server不可能发起连接——Client会定时向Server发送请求，保证二者之间的通信状态。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.6/" data-id="ck5na8rtu0005g4tw9d3808hd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第四周/1.10" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.10/" class="article-date">
  <time datetime="2020-01-19T06:07:45.850Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.10/">第四周/1.10</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>抓包外联域名</p>
<p>导出csv统计分析</p>
<p>合并计数域名</p>
<p>获取访问最多的域名</p>
<p>学习bitdefengder</p>
<blockquote>
<p><a href="https://ipcsn.wordpress.com/2014/08/09/bitdefender2015/" target="_blank" rel="noopener">https://ipcsn.wordpress.com/2014/08/09/bitdefender2015/</a></p>
</blockquote>
<p>扫描磁盘，检测可疑程序</p>
<p>分析xp系统日志</p>
<p>导出系统日志、统计分析</p>
<p>查看可疑服务开启</p>
<p>上午就统计了域名</p>
<p>查到了一个特洛伊木马，操作不当导致木马被杀、磁盘修改、虚拟机打不开。。。</p>
<p>之后尝试磁盘网络共享，通过只读方式扫描木马</p>
<p>找到可疑木马A0081600.exe</p>
<p>被杀软识别为特洛伊木马</p>
<p>程序启动一段时间后，进程结束，程序本体消失</p>
<p>直连传输文件</p>
<blockquote>
<p><a href="https://jingyan.baidu.com/article/17bd8e521575f985ab2bb8e0.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/17bd8e521575f985ab2bb8e0.html</a></p>
</blockquote>
<p>修改IP、网关</p>
<p>另一台网关指向第一台</p>
<p>ping测试</p>
<p>文件夹属性设置高级共享</p>
<p>开启之后需要账号密码登录</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.10/" data-id="ck5na8rts0004g4twd3jodd5z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第五周/1.19" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.19/" class="article-date">
  <time datetime="2020-01-19T06:07:42.867Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.19/">第五周/1.19</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="早报"><a href="#早报" class="headerlink" title="早报"></a>早报</h1><h2 id="0601"><a href="#0601" class="headerlink" title="0601"></a>0601</h2><p>CVE-2020-0601安装补丁</p>
<h1 id="反序字符"><a href="#反序字符" class="headerlink" title="反序字符"></a>反序字符</h1><p>前两天有突然个坏人从QQ上发来了个rar压缩文件，当时我肯定这个是病毒，但是在我解压后发现，这个是一个asxarcs.txt的文本文件，随后我进入文件夹选项，发现隐藏已知文件类型的扩展名的勾已经去掉了，我又猜想这个可能是个广告吧，于是想打开看看，右击一下后发现，没有打开选项，只有测试、配置、安装这几个选项，此时我意识到不对，这绝对是个病毒、差一点点就打开了，好险。。 经过我的一番研究，终于让我找到了这个病毒的制作方法了。</p>
<p>​               1.制作一个病毒;<br>​               2.找一个文本文件与这个病毒进行捆绑；<br>【重点】3.将这个病毒命名为asxatxt.scr；<br>【重点】4.继续重命名，把光标移动到文件名中txt的前面，右击-<strong>插入Unicode控制字符</strong>-RLO，插入后回车；<br>​               5.这时你就会发现这个病毒的后缀名变成了TXT；<br>​               6.做个免杀，这个病毒就可以发出去了。<br>PS：这个是利用RLO控制字符，将 asxatxt.scr文件名中的txt.scr更改成从右往左读的顺序，但是文件格式依旧是scr，按照这个方法可以制作出把asdgpj.exe文件名改成asdexe.jpg</p>
<h1 id="木马的数字签名"><a href="#木马的数字签名" class="headerlink" title="木马的数字签名"></a>木马的数字签名</h1><p>签名攻击事件，主要分为签名盗用类、签名冒用类、签名仿冒类和签名过期类</p>
<h2 id="签名盗用类"><a href="#签名盗用类" class="headerlink" title="签名盗用类"></a>签名盗用类</h2><p>是指恶意程序使用的数字签名为某公司官方使用过的相同数字签名，其数字证书的指纹也相同。</p>
<h2 id="签名冒用类"><a href="#签名冒用类" class="headerlink" title="签名冒用类"></a>签名冒用类</h2><p>是指恶意程序使用的数字签名与某公司的数字签名串相同，但并非使用该公司的官方证书签发，而是另外从其他签发机构申请到相同签名主体的证书。通过对比知名公司的文件和木马文件，发现两者数字证书的颁发机构不同。由于不同的颁发机构可以为同一家公司颁发证书，但是审核标准不一致，所以黑客就利用了这点成功申请了知名公司的数字证书。利用了相对容易申请的机构来申请数字证书，而且持续不断的签发木马程序。</p>
<h2 id="签名仿冒类"><a href="#签名仿冒类" class="headerlink" title="签名仿冒类"></a>签名仿冒类</h2><p>是指恶意程序使用的数字签名为某公司数字签名的仿冒品，并非该公司官方的签名串，而是仿冒该公司数字签名串去申请了具有混淆特征的签名串。</p>
<h2 id="签名过期类"><a href="#签名过期类" class="headerlink" title="签名过期类"></a>签名过期类</h2><p>是指恶意程序使用的数字签名为某公司官方使用过的相同数字签名，但其是在它使用的数字证书过期后进行签署的，所以正常系统将显示该签名过期，而如果修改系统的时间使其满足有效期则签名可显示正常。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.19/" data-id="ck5na8ru1000cg4tw6nch7lul" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第五周/1.16" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.16/" class="article-date">
  <time datetime="2020-01-19T06:07:42.858Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.16/">第五周/1.16</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="早报"><a href="#早报" class="headerlink" title="早报"></a>早报</h1><h2 id="伊朗APT组织"><a href="#伊朗APT组织" class="headerlink" title="伊朗APT组织"></a>伊朗APT组织</h2><h3 id="OliRig"><a href="#OliRig" class="headerlink" title="OliRig"></a>OliRig</h3><p>主要在中东开展业务的伊朗威胁组织，其目标是该地区各行各业的组织，偶尔也会将目标锁定在中东以外的组织，没有发现0days或使用高级漏洞利用程序，使用开源工具，例如 <a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener">Mimikatz</a> 和 <a href="https://github.com/AlessandroZ/LaZagne/commits?author=AlessandroZ" target="_blank" rel="noopener">laZagne</a>，Microsoft发行版或sysinternals上可用的常见sysadmin工具集</p>
<h3 id="MuddyWater"><a href="#MuddyWater" class="headerlink" title="MuddyWater"></a>MuddyWater</h3><p>主要针对中东国家，也针对欧洲和北美国家。该组织的受害者主要是在电信，政府（IT服务）和石油部门，倾向于使用开源工具或系统内部工具在目标网络之间故意移动，而不是大规模运行漏洞利用程序或扫描程序</p>
<h3 id="APT33"><a href="#APT33" class="headerlink" title="APT33"></a>APT33</h3><p>APT33是一个怀疑的伊朗威胁组织，至少从2013年开始运营。该组织的目标是美国，沙特阿拉伯和韩国等多个行业的组织，APT33通过使用诸如<strong>shamoon</strong> 和 <strong>stoneDrill的</strong>恶意软件显示了破坏意图 ，而Muddy大多希望“ <strong>后门</strong> ”受害者</p>
<h3 id="CopyKittens"><a href="#CopyKittens" class="headerlink" title="CopyKittens"></a>CopyKittens</h3><p>至少从2013年就开始运营的伊朗网络间谍组织。它瞄准的国家包括以色列，沙特阿拉伯，土耳其，美国，约旦和德国，CopyKittens会在受攻击的网络内部产生更多的噪音，并且更易于检测，另一个特征是“代码签名”</p>
<h3 id="Cleaver"><a href="#Cleaver" class="headerlink" title="Cleaver"></a>Cleaver</h3><p>Cleaver攻击功能随着时间的推移发展非常迅速，自2012年以来一直活跃。它们似乎已渗透到一些世界经济强国中</p>
<h2 id="一款优秀的XSS批量检测工具"><a href="#一款优秀的XSS批量检测工具" class="headerlink" title="一款优秀的XSS批量检测工具"></a>一款优秀的XSS批量检测工具</h2><p>NoXss收集在笔记目录下</p>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>NoXss主要是通过“符号闭合”来检测xss隐患，使用基于“反射位置”的payload进行探测（目前一共8个），相比fuzz减少了很多盲目性。比如当请求参数的值出现在response的javascript代码段中，并且是以双引号的形式进行闭合，那么NoXss将使用xssjs”;这个payload；如果是以单引号的形式进行闭合，则会使用xssjs’;进行测试。更多的位置分类以及payload请参考<a href="https://github.com/lwzSoviet/NoXss/blob/master/README.md" target="_blank" rel="noopener">https://github.com/lwzSoviet/NoXss/blob/master/README.md</a></p>
<p><strong>但请不要对NoXss抱有太多的期望，它对较为复杂的xss（比如存储型）无能为力。</strong></p>
<h3 id="支持配置请求头"><a href="#支持配置请求头" class="headerlink" title="支持配置请求头"></a>支持配置请求头</h3><p>在批量检测的过程中通常需要维持登录态，一些应用的后端还会校验Referer甚至其他的一些自定义的HTTP请求头部，NoXss支持用户对此进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python start.py --url url --cookie cookie</span><br></pre></td></tr></table></figure>

<p>默认情况下，NoXss会根据当前扫描的url自动添加Referer头部。</p>
<h1 id="逆向学习"><a href="#逆向学习" class="headerlink" title="逆向学习"></a>逆向学习</h1><p>我写的博客</p>
<blockquote>
<p><a href="https://blog.csdn.net/qq_41581915/article/details/104009189" target="_blank" rel="noopener">https://blog.csdn.net/qq_41581915/article/details/104009189</a></p>
</blockquote>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><blockquote>
<p><a href="https://www.52pojie.cn/thread-350397-1-1.html" target="_blank" rel="noopener">OllyDbg</a>(OD)：<a href="https://www.52pojie.cn/thread-350397-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-350397-1-1.html</a><br><a href="https://www.52pojie.cn/thread-12865-1-1.html" target="_blank" rel="noopener">PEID</a>：<a href="https://www.52pojie.cn/thread-170387-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-170387-1-1.html</a><br><a href="https://www.52pojie.cn/thread-437586-1-1.html" target="_blank" rel="noopener">Exeinfo PE</a>：<a href="https://www.52pojie.cn/thread-437586-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-437586-1-1.html</a><br>樱花补丁制作工具：<a href="https://www.52pojie.cn/thread-62307-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-62307-1-1.html</a><br>内存补丁生成器：<a href="https://www.52pojie.cn/thread-162411-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-162411-1-1.html</a><br>注册机生成器：<a href="https://www.52pojie.cn/thread-159470-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-159470-1-1.html</a><br><a href="https://www.52pojie.cn/thread-675251-1-1.html" target="_blank" rel="noopener">IDA</a> Pro v7：<a href="https://www.52pojie.cn/thread-675251-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-675251-1-1.html</a></p>
</blockquote>
<h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><blockquote>
<p><a href="https://www.52pojie.cn/thread-582852-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-582852-1-1.html</a></p>
</blockquote>
<h2 id="第一课"><a href="#第一课" class="headerlink" title="第一课"></a>第一课</h2><h3 id="加壳"><a href="#加壳" class="headerlink" title="加壳"></a>加壳</h3><p>工具一般都是通过目录下的<strong>userdb.txt</strong>（查壳程序不同可能数据库名有出入）数据库进行加壳程序特征对比</p>
<h2 id="crackme"><a href="#crackme" class="headerlink" title="crackme"></a>crackme</h2><p>从今天开始小白要学习逆向知识，自己学习没有啥头绪，不如就从CrackMe开始，一关关打下去也会有所收获把！</p>
<blockquote>
<p><a href="https://www.52pojie.cn/thread-709699-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-709699-1-1.html</a></p>
</blockquote>
<h3 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h3><p>首先用工具查看一些基本的信息，可以看到编译程序是<strong>Delphi3.0</strong>，没有壳</p>
<p><img src="1.16.assets/1.png" alt="1"></p>
<p>进去的第一个界面，嘲讽一下。。。</p>
<p><img src="1.16.assets/2.png" alt="2"></p>
<p>然后是程序主体，分别有三个按钮</p>
<p>一个是<code>Serial/Name</code>，需要输入用户名和注册码才能通过，另外一个<code>Serial</code>只需要输入一个注册码一类的东西，最后就是退出程序</p>
<p><img src="1.16.assets/3.png" alt="3"></p>
<p>这里先点击最左侧的<code>Serial/Name</code></p>
<p><img src="1.16.assets/4.png" alt="4"></p>
<p>这里提示输入用户名和注册码，随便填入提交，观察提示</p>
<p><img src="1.16.assets/5.png" alt="5"></p>
<p>点击<code>Check it Baby!</code> 它会弹出一个对话框提示： <code>Sorry， The Serial is incorrect !</code></p>
<p>再换几个随意试试，发现就这一种情况。</p>
<p>OK，出现了对话框这就很好办，说明作者在校验注册码之后发现如果错误了就直接弹窗，我们只要找到弹出对话框的地方，向上跟踪，就可以找出判断是否正确的地方了</p>
<p>接着就用到OD来分析</p>
<p>看了好久总算晓得一点OD的使用方法</p>
<blockquote>
<p>OD打开需要调试的程序</p>
<p>打开之后，点击运行的图标</p>
<p>程序正常运行，可以随时暂停检测行为</p>
</blockquote>
<p>使用OD打开程序后，进行上面重复的操作，在出现对话框提示<code>Sorry， The Serial is incorrect !</code>时，点击暂停，打开<strong>主线程调用堆栈</strong>信息</p>
<p><img src="1.16.assets/6.png" alt="6"></p>
<p>有一些攻略是这么写的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这里有两个MessageBox的地址，第一个地址为77D5082F这个地址明显太大,不在模块的领空，不是的。</span><br><span class="line">第二个地址为0042A1AE，和00400100地址非常接近，十有八九就是它了。</span><br><span class="line">右键 show call, 在Call上面设置断点。</span><br></pre></td></tr></table></figure>

<p>然后自己去了解了一下<code>MessageBox</code> 的功能就是显示一个消息对话框，在弹窗时，我们暂停进程，然后在OD中找到那一段来分析判断错误弹窗的条件，我的理解大概就是这样</p>
<p>按照上面的操作，进去之后就是这样的</p>
<p><img src="1.16.assets/7.png" alt="7"></p>
<p><code>show call</code>进去后按<code>F2</code>设置断点</p>
<blockquote>
<p>注意反复调试需要关闭断点，不会一直卡在那个断点处</p>
<p>可以把断点理解为存档</p>
</blockquote>
<p><img src="1.16.assets/8.png" alt="8"></p>
<p>上下查看，发现与弹窗内容相同的字符串，哈哈这可能是个突破点</p>
<p><img src="1.16.assets/9.png" alt="9"></p>
<p>JNZ会通过它上面的call 004039FC 判断我们的伪码是否正确，判断的结果存在EAX中，如果EAX不等于就跳转到错误提示信息框那里。</p>
<p>我们的目的是无论伪码是否正确都通过验证，所以最简单的办法就是将jnz这句使用NOP填充，我们尝试一下：选择JNZ这句，右键<code>Binary</code>-&gt;<code>Fill with NOPS</code>.回到原始程序，再次点击<code>Check it baby!</code></p>
<p>提示<code>Good Job！</code>通过了！</p>
<p>但是经过测试，必须要<strong>用户名大于四位</strong>，才能通过</p>
<p><img src="1.16.assets/10.png" alt="10"></p>
<p>小于四位，运行会停止，这个校验字符串长度是在断点上方，查看上方<code>jeg</code>部分，如果想要输入的账户长度不大于4，只需要把JGE给修改成JMP让其强制跳转即可</p>
<p><img src="1.16.assets/12.png" alt="12"></p>
<p><img src="1.16.assets/11.png" alt="11"></p>
<p>上面这些就是爆破的部分，然后接下来尝试能否分析出注册机算法</p>
<p>将所有断点、修改的内容右键UNDO取消，然后重新一遍操作，随便输入然后报错，跳转<code>show call</code></p>
<p><img src="1.16.assets/13.png" alt="13"></p>
<p>这里将选中代码复制出来查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0042FAFE  |.  E8 F93EFDFF   call Acid_bur.004039FC ;  这个CALL的返回值</span><br><span class="line">0042FB03  |.  75 1A         jnz XAcid_bur.0042FB1F   ;  上一个CALL的返回值不等于0则跳转到错误消息</span><br><span class="line">0042FB05  |.  6A 00         push 0x0</span><br><span class="line">0042FB07  |.  B9 CCFB4200   mov ecx,Acid_bur.0042FBCC</span><br><span class="line">0042FB0C  |.  BA D8FB4200   mov edx,Acid_bur.0042FBD8</span><br><span class="line">0042FB11  |.  A1 480A4300   mov eax,dword ptr ds:[0x430A48]</span><br><span class="line">0042FB16  |.  8B00          mov eax,dword ptr ds:[eax]</span><br><span class="line">0042FB18  |.  E8 53A6FFFF   call Acid_bur.0042A170</span><br><span class="line">0042FB1D  |.  EB 18         jmp XAcid_bur.0042FB37 ;  强制跳转，跳过了错误显示。</span><br><span class="line">0042FB1F  |&gt;  6A 00         push 0x0</span><br><span class="line">0042FB21  |.  B9 74FB4200   mov ecx,Acid_bur.0042FB74</span><br><span class="line">0042FB26  |.  BA 80FB4200   mov edx,Acid_bur.0042FB80</span><br><span class="line">0042FB2B  |.  A1 480A4300   mov eax,dword ptr ds:[0x430A48]</span><br><span class="line">0042FB30  |.  8B00          mov eax,dword ptr ds:[eax]</span><br><span class="line">0042FB32  |.  E8 39A6FFFF   call Acid_bur.0042A170 ;  函数内调用了MessageBox显示错误</span><br></pre></td></tr></table></figure>

<p>所以在<code>0042FAFE</code>处设置断点，启动调试，注意将窗口最大化方便查看<strong>寄存器</strong></p>
<p><img src="1.16.assets/14.png" alt="14"></p>
<p>这里可以看到，输入的注册码在寄存器中显示，同时上方还有一串字符，大胆猜测为计算出来后的注册码</p>
<p>尝试将输入的注册码替换为寄存器的，保留用户名</p>
<p><img src="1.16.assets/15.png" alt="15"></p>
<p>emmmm然后就得分析这个注册码怎么来的</p>
<p>就在<code>0042FAFE</code>往上翻翻，给出的部分注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">0042FA79  |&gt; \8D55 F0       lea edx,[local.4]</span><br><span class="line">0042FA7C  |.  8B83 DC010000 mov eax,dword ptr ds:[ebx+0x1DC]</span><br><span class="line">0042FA82  |.  E8 D1AFFEFF   call Acid_bur.0041AA58            ;  获取账户，字符串，字符串首地址存储在EBP-0X10处</span><br><span class="line">0042FA87  |.  8B45 F0       mov eax,[local.4]</span><br><span class="line">0042FA8A  |.  0FB600        movzx eax,byte ptr ds:[eax]       ;  DWORD DATA &#x3D; (DWORD)buff[0];</span><br><span class="line">0042FA8D  |.  F72D 50174300 imul dword ptr ds:[0x431750]      ;  DATA * 0x43175 &#x3D;&#x3D; DATA * 0x29</span><br><span class="line">0042FA93  |.  A3 50174300   mov dword ptr ds:[0x431750],eax   ;  0x431750 &#x3D; DATA * 0x29;</span><br><span class="line">0042FA98  |.  A1 50174300   mov eax,dword ptr ds:[0x431750]</span><br><span class="line">0042FA9D  |.  0105 50174300 add dword ptr ds:[0x431750],eax   ;  0x431750 *&#x3D; 2</span><br><span class="line">0042FAA3  |.  8D45 FC       lea eax,[local.1]</span><br><span class="line">0042FAA6  |.  BA ACFB4200   mov edx,Acid_bur.0042FBAC</span><br><span class="line">0042FAAB  |.  E8 583CFDFF   call Acid_bur.00403708            ;  将CW字符串首地址存储在EBP-0x4处</span><br><span class="line">0042FAB0  |.  8D45 F8       lea eax,[local.2]</span><br><span class="line">0042FAB3  |.  BA B8FB4200   mov edx,Acid_bur.0042FBB8         ;  CRACKED</span><br><span class="line">0042FAB8  |.  E8 4B3CFDFF   call Acid_bur.00403708            ;  将字符串地址存储在EBP-0X8处</span><br><span class="line">0042FABD  |.  FF75 FC       push [local.1]</span><br><span class="line">0042FAC0  |.  68 C8FB4200   push Acid_bur.0042FBC8            ;  UNICODE &quot;-&quot;</span><br><span class="line">0042FAC5  |.  8D55 E8       lea edx,[local.6]</span><br><span class="line">0042FAC8  |.  A1 50174300   mov eax,dword ptr ds:[0x431750]</span><br><span class="line">0042FACD  |.  E8 466CFDFF   call Acid_bur.00406718            ;  将0x431750存储的十六进制转换成字符串，地址存储在EBP-0x18处</span><br><span class="line">0042FAD2  |.  FF75 E8       push [local.6]</span><br><span class="line">0042FAD5  |.  68 C8FB4200   push Acid_bur.0042FBC8            ;  UNICODE &quot;-&quot;</span><br><span class="line">0042FADA  |.  FF75 F8       push [local.2]</span><br><span class="line">0042FADD  |.  8D45 F4       lea eax,[local.3]</span><br><span class="line">0042FAE0  |.  BA 05000000   mov edx,0x5</span><br><span class="line">0042FAE5  |.  E8 C23EFDFF   call Acid_bur.004039AC            ;  字符串拼接。(EBP-0X4)+(EBP-0X18)+(EBP-0X8) 存储在ebp-0xC</span><br><span class="line">0042FAEA  |.  8D55 F0       lea edx,[local.4]</span><br><span class="line">0042FAED  |.  8B83 E0010000 mov eax,dword ptr ds:[ebx+0x1E0]</span><br><span class="line">0042FAF3  |.  E8 60AFFEFF   call Acid_bur.0041AA58            ;  得到输入的密码</span><br><span class="line">0042FAF8  |.  8B55 F0       mov edx,[local.4]</span><br><span class="line">0042FAFB  |.  8B45 F4       mov eax,[local.3]</span><br><span class="line">0042FAFE  |.  E8 F93EFDFF   call Acid_bur.004039FC            ;  输入的密码与程序计算出来的KEY做比较</span><br><span class="line">0042FB03  |.  75 1A         jnz XAcid_bur.0042FB1F            ;  上一个CALL的返回值不等于0则跳转到错误消息</span><br></pre></td></tr></table></figure>

<p>攻略上把这一段转换成C语言，得出结论：在计算KEY中，只使用了用户的第一个字母，后三位没用。所以，账户abcd和aaaa使用的KEY是相同的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">void Decryption(char* mima)</span><br><span class="line">&#123;</span><br><span class="line">    char szBuff[260];</span><br><span class="line">    unsigned long data &#x3D; (unsigned long)mima[0];</span><br><span class="line">    data *&#x3D; 0X29;</span><br><span class="line">    data *&#x3D; 2;</span><br><span class="line">    sprintf(szBuff, &quot;CW-%d-CRACKED&quot;, data);</span><br><span class="line">    printf(&quot;%s \r\n&quot;, szBuff);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>emmm之后还得研究</p>
<p>第二个按钮，操作类似，暂停之后，往上找到<code>jnz</code>直接NOP就OK<img src="1.16.assets/16.png" alt="16"></p>
<p>继续往上看发现注册码是一个固定的值</p>
<p><img src="1.16.assets/17.png" alt="17"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.16/" data-id="ck5na8ru0000bg4tw3sou5zn7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第五周/1.15" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.15/" class="article-date">
  <time datetime="2020-01-19T06:07:42.847Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.15/">第五周/1.15</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="早报"><a href="#早报" class="headerlink" title="早报"></a>早报</h1><h2 id="office控件"><a href="#office控件" class="headerlink" title="office控件"></a>office控件</h2><p>外网机没有office弄不了。。。</p>
<p>word365</p>
<p>点击开发工具→旧式窗体→更多控件</p>
<p>这里选Microsoft LnkEdit Control，选其他的也行，再配合上漏洞，如flash啥的。</p>
<p>然后编辑代码</p>
<blockquote>
<p><a href="https://www.freebuf.com/articles/es/224347.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/es/224347.html</a></p>
</blockquote>
<h2 id="powershell文章"><a href="#powershell文章" class="headerlink" title="powershell文章"></a>powershell文章</h2><blockquote>
<p><a href="https://www.freebuf.com/articles/web/220046.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/220046.html</a></p>
</blockquote>
<h2 id="秀·网站"><a href="#秀·网站" class="headerlink" title="秀·网站"></a>秀·网站</h2><blockquote>
<p><a href="https://hackertyper.net/" target="_blank" rel="noopener">https://hackertyper.net/</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">今天上午就只是把镜像取证的报告写完了，还有把剩下的windows取证环境题目做完（八个）</span><br><span class="line">下午的话讲讲课，了解PcHunter等一下windows机制，没了</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.15/" data-id="ck5na8rtz000ag4tw5tzkaodp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第五周/1.14" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.14/" class="article-date">
  <time datetime="2020-01-19T06:07:42.837Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.14/">第五周/1.14</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="早报"><a href="#早报" class="headerlink" title="早报"></a>早报</h1><p>Hessian反序列化RCE漏洞复现及分析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;vuls&#x2F;224280.html</span><br></pre></td></tr></table></figure>

<h2 id="关于RPC"><a href="#关于RPC" class="headerlink" title="关于RPC"></a>关于RPC</h2><p>主要是在freebuf上看到了一个RPC框架的复现漏洞，感觉反序列漏洞在java环境下还是比较多的</p>
<blockquote>
<p>RPC是指<strong>远程过程调用</strong>，也就是说两台服务器A，B，一个应用部署在A服务器上，想调用B服务器上应用提供的函数/方法，由于不在一个内存空间，不能直接调用，需要通过网络来表达调用的语义和传达调用的数据。</p>
</blockquote>
<p>看这个概念就感觉有可以利用的点</p>
<h2 id="关于JNDI注入"><a href="#关于JNDI注入" class="headerlink" title="关于JNDI注入"></a>关于JNDI注入</h2><p>因为后续的复现是要利用这个注入的，不太熟悉</p>
<blockquote>
<p>Java命名和目录接口（JNDI）是一种Java API，类似于一个索引中心，它允许客户端通过name发现和查找数据和对象。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;6633#toc-10</span><br></pre></td></tr></table></figure>

<h1 id="取证分析脚本"><a href="#取证分析脚本" class="headerlink" title="取证分析脚本"></a>取证分析脚本</h1><h2 id="python调用cmd"><a href="#python调用cmd" class="headerlink" title="python调用cmd"></a>python调用cmd</h2><p>①os.system(‘dir’)</p>
<p>这条命令只会输出执行的cmd命令，甚至都不用print，直接输出，但是我们需要对输出的命令进行分析，必须得到它的返回值，因此在这里不考虑这个函数</p>
<p>②os.popen(‘dir’)</p>
<p>返回值很正常</p>
<p>③subprocess.Popen(‘netstat -ano’,shell=True,stdout=subprocess.PIPE)</p>
<p>创建一个进程去访问subprocess，但是返回值是通过一个管道来传输</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;foreversong.cn&#x2F;archives&#x2F;301</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line">#-*-coding:utf-8-*-</span><br><span class="line">import _winreg</span><br><span class="line">import os</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line">def namelist(string):</span><br><span class="line">	string&#x3D;string.replace(&#39;\&#39;&#39;,&#39;&#39;)</span><br><span class="line">	string&#x3D;string.replace(&#39; &#39;,&#39;&#39;)</span><br><span class="line">#这个函数主要是字符串进行处理</span><br><span class="line">	loca&#x3D;string.find(r&#39;\x00\x00&#39;)</span><br><span class="line">#十六进制文件名的结尾标志\x00\x00</span><br><span class="line">	#print loca</span><br><span class="line">	return string[:loca].replace(&#39;\\x00&#39;,&#39;&#39;)</span><br><span class="line">#返回结束标志前的文件名</span><br><span class="line"></span><br><span class="line">fp&#x3D;open(&#39;forensics.txt&#39;,&#39;w&#39;)</span><br><span class="line"></span><br><span class="line">key &#x3D; _winreg.OpenKey(_winreg.HKEY_CURRENT_USER,r&#39;Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs&#39;)</span><br><span class="line">#注册表文件使用记录的位置</span><br><span class="line">i&#x3D;0</span><br><span class="line">fp.write(&#39;一、最近的文件使用记录：\n&#39;)</span><br><span class="line">try:</span><br><span class="line">	while True:</span><br><span class="line">		#没有其他办法获取所有键值，只能遍历</span><br><span class="line">		name, value, type &#x3D; _winreg.EnumValue(key, i)</span><br><span class="line">		#读取键值中的信息</span><br><span class="line">		keyvalue&#x3D;str(repr(value))</span><br><span class="line">		#这里的repr()是将内存中的内容转化为编译器能够识别的内容</span><br><span class="line">		#print i,&#39;&#39;,namelist(keyvalue)</span><br><span class="line">		fp.write(str(i))</span><br><span class="line">		fp.write(&#39; &#39;)</span><br><span class="line">		fp.write(namelist(keyvalue))</span><br><span class="line">		#经过我们的处理后，写入最近使用的文件名</span><br><span class="line">		fp.write(&#39;\n&#39;)</span><br><span class="line">		i+&#x3D;1</span><br><span class="line">except:</span><br><span class="line">	print &#39;文件使用记录已写入文件！&#39;</span><br><span class="line"></span><br><span class="line">fp.write(&#39;\n&#39;)</span><br><span class="line">fp.write(&#39;二、最近Internet Explorer输入的url地址：\n&#39;)</span><br><span class="line">key &#x3D; _winreg.OpenKey(_winreg.HKEY_CURRENT_USER,r&#39;Software\Microsoft\Internet Explorer\TypedURLs&#39;)</span><br><span class="line">#这里同样是利用注册表，取证分析的是IE浏览器曾经输入的url地址</span><br><span class="line">j&#x3D;0</span><br><span class="line">try:</span><br><span class="line">	while True:</span><br><span class="line">		name, value, type &#x3D; _winreg.EnumValue(key, j)</span><br><span class="line">		keyvalue&#x3D;namelist(str(repr(value)))</span><br><span class="line">		#与上述步骤一样，不多说</span><br><span class="line">		keyvalue&#x3D;keyvalue.replace(&#39;u&#39;,&#39;&#39;)</span><br><span class="line">		#可能是unicode编码，在地址头总是有个u的标志，将这个标志去掉</span><br><span class="line">		fp.write(str(j))</span><br><span class="line">		fp.write(&#39; &#39;)</span><br><span class="line">		fp.write(keyvalue)</span><br><span class="line">		#写入url地址</span><br><span class="line">		fp.write(&#39;\n&#39;)</span><br><span class="line">		j+&#x3D;1</span><br><span class="line">except:</span><br><span class="line">	print &#39;最近输入的url地址已写入文件！&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fp.write(&#39;\n&#39;)</span><br><span class="line">fp.write(&#39;三、系统启动项：\n&#39;)</span><br><span class="line">key &#x3D; _winreg.OpenKey(_winreg.HKEY_LOCAL_MACHINE,r&#39;Software\Microsoft\Windows\CurrentVersion\Run&#39;)</span><br><span class="line">#启动项分为永久启动还有一次启动，这里只讨论永久启动项</span><br><span class="line">m&#x3D;0</span><br><span class="line">try:</span><br><span class="line">	while True:</span><br><span class="line">		name, value, type &#x3D; _winreg.EnumValue(key, m)</span><br><span class="line">		keyvalue&#x3D;namelist(str(repr(value)))</span><br><span class="line">		keyvalue&#x3D;keyvalue.replace(&#39;u&#39;,&#39;&#39;)</span><br><span class="line">		#同样开头有u标志，做replace处理</span><br><span class="line">		fp.write(str(m))</span><br><span class="line">		fp.write(&#39; &#39;)</span><br><span class="line">		fp.write(keyvalue)</span><br><span class="line">		fp.write(&#39;\n&#39;)</span><br><span class="line">		m+&#x3D;1</span><br><span class="line">except:</span><br><span class="line">	print &#39;启动项已写入文件!&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fp.write(&#39;\n&#39;)</span><br><span class="line">fp.write(&#39;四、曾经接入过的U盘：\n&#39;)</span><br><span class="line">open_key&#x3D;_winreg.OpenKey(_winreg.HKEY_LOCAL_MACHINE,r&quot;System\ControlSet001\Enum\USBSTOR&quot;)</span><br><span class="line">#这里取证分析的是曾经插入电脑的u盘设备</span><br><span class="line">#这里我获取的是USBTOR注册表下的所有目录名称</span><br><span class="line">#因为目录名称即为U盘名，因此不用获取键值  </span><br><span class="line">countkey&#x3D;_winreg.QueryInfoKey(open_key)[0]  </span><br><span class="line">#获取目录数目</span><br><span class="line">ulist&#x3D;[]  </span><br><span class="line">for i in range(int(countkey)):  </span><br><span class="line">    name&#x3D;_winreg.EnumKey(open_key,i)   </span><br><span class="line">    ulist.append(name)  </span><br><span class="line">    #将目录名添加到列表中</span><br><span class="line">_winreg.CloseKey(open_key)  </span><br><span class="line">for i in range(len(ulist)):</span><br><span class="line">	fp.write(ulist[i])</span><br><span class="line">	#将u盘名写入文件里</span><br><span class="line">	fp.write(&#39;\n&#39;)</span><br><span class="line">print &#39;曾使用的U盘名已写入文件!&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fp.write(&#39;\n&#39;)</span><br><span class="line">fp.write(&#39;五、系统端口号：\n&#39;)</span><br><span class="line">#从这里开始，我主要使用的是cmd命令的调用</span><br><span class="line">port&#x3D;[]</span><br><span class="line">shell&#x3D;subprocess.Popen(&quot;netstat -ano&quot;,shell&#x3D;True,stdout&#x3D;subprocess.PIPE)</span><br><span class="line">#这里我使用的是subprocess.Popen()函数，主要它可以调用返回值</span><br><span class="line">#这里的stdout一定要加，不然返回值获取不到</span><br><span class="line">shell&#x3D;shell.stdout.readlines()</span><br><span class="line">#按行读取</span><br><span class="line">for line in shell:</span><br><span class="line">	line&#x3D;line.strip()</span><br><span class="line">	#删去字符串前后的空格</span><br><span class="line">	#print line</span><br><span class="line">	lineloc&#x3D;line.find(&quot;0.0.0.0&quot;)</span><br><span class="line">	#寻找本地端口</span><br><span class="line">	if lineloc!&#x3D;-1:</span><br><span class="line">		#find存在返回值，若未找到，值为-1</span><br><span class="line">		lineloc+&#x3D;8</span><br><span class="line">		#+8是为了跳过0.0.0.0:这个前缀</span><br><span class="line">		portnum&#x3D;int(line[lineloc:lineloc+5].strip())</span><br><span class="line">		#端口号最大65535,即最大五位数</span><br><span class="line">		if portnum!&#x3D;0:</span><br><span class="line">			#实际测试本地端口有环回接口，这些接口不做考虑</span><br><span class="line">			port.append(line[:3])</span><br><span class="line">			port.append(portnum)</span><br><span class="line"></span><br><span class="line">for i in range(len(port)):</span><br><span class="line">	#print port[i]</span><br><span class="line">	fp.write(str(port[i]))</span><br><span class="line">	fp.write(&#39;  &#39;)</span><br><span class="line">	if i%2&#x3D;&#x3D;1:</span><br><span class="line">		fp.write(&#39;\n&#39;)</span><br><span class="line">	#因为端口号之前会标记TCP还是UDP，因此每写一个TCP&#x2F;UDP和端口就换行</span><br><span class="line">print &#39;系统端口已写入文件!&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fp.write(&#39;\n&#39;)</span><br><span class="line">fp.write(&#39;六、系统账号：\n&#39;)</span><br><span class="line">sysuser&#x3D;subprocess.Popen(&quot;net user&quot;,shell&#x3D;True,stdout&#x3D;subprocess.PIPE)</span><br><span class="line">sysuser_list&#x3D;sysuser.stdout.readlines()</span><br><span class="line">#同上述</span><br><span class="line">flag&#x3D;False</span><br><span class="line">for line in sysuser_list:</span><br><span class="line">	line&#x3D;repr(line.strip())</span><br><span class="line">	#这里在实际获取中得不到系统账号</span><br><span class="line">	#因此只能用repr()进行转化</span><br><span class="line">	if &quot;Administrator&quot; in line:</span><br><span class="line">		flag&#x3D;True</span><br><span class="line">		#开始进行写入</span><br><span class="line">	if r&quot;\xc3\xfc&quot; in line:</span><br><span class="line">		flag&#x3D;False</span><br><span class="line">		#这是命令的utf16进制编码，尚未想到办法转化</span><br><span class="line">		#在查询完系统用户后，会有一个&quot;命令成功完成。&quot;,以这个作为终止条件</span><br><span class="line">	if flag&#x3D;&#x3D;True:</span><br><span class="line">		fp.write(line.replace(&#39;\&#39;&#39;,&#39;&#39;))</span><br><span class="line">		fp.write(&#39;\n&#39;)</span><br><span class="line">		#写入Administrator开始到结束中间的用户</span><br><span class="line"></span><br><span class="line">print &#39;系统账号已写入文件！&#39;</span><br><span class="line">sysuser.kill()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fp.write(&#39;\n&#39;)</span><br><span class="line">fp.write(&#39;七、无线网络历史记录：\n&#39;)</span><br><span class="line">wirelesscommand&#x3D;&#39;&#39;&#39;for &#x2F;f &quot;skip&#x3D;9 tokens&#x3D;1,2 delims&#x3D;:&quot; %i in (&#39;netsh wlan show profiles&#39;) do  @echo %j | findstr -i -v echo | netsh wlan show profiles %j key&#x3D;clear&#39;&#39;&#39;</span><br><span class="line">#这里的cmd命令可以查询所有曾经连接的无线网络信息</span><br><span class="line">wireless&#x3D;subprocess.Popen(wirelesscommand,shell&#x3D;True,stdout&#x3D;subprocess.PIPE)</span><br><span class="line">wireless_list&#x3D;wireless.stdout.readlines()</span><br><span class="line"></span><br><span class="line">ssid_name&#x3D;0</span><br><span class="line">ssid_passwd&#x3D;0</span><br><span class="line">for line in wireless_list:</span><br><span class="line">	line&#x3D;repr(line.strip())</span><br><span class="line">	#repr()转化为可以输出的字符串</span><br><span class="line">	#print line</span><br><span class="line">	if r&#39;SSID \xc3\xfb\xb3\xc6&#39; in line :</span><br><span class="line">		#这里同样是utf16进制编码，其实中文为&quot;SSID 名称&quot;</span><br><span class="line">		line&#x3D;line.replace(r&#39;SSID \xc3\xfb\xb3\xc6&#39;,&#39;&#39;)</span><br><span class="line">		line&#x3D;line.replace(&#39;:&#39;,&#39;&#39;)</span><br><span class="line">		line&#x3D;line.replace(r&#39;\xa1\xb0&#39;,&#39;&#39;)</span><br><span class="line">		line&#x3D;line.replace(r&#39;\xa1\xb1&#39;,&#39;&#39;)</span><br><span class="line">		line&#x3D;line.replace(&#39;\&#39;&#39;,&#39;&#39;)</span><br><span class="line">		#将获取的无线网络名称进行字符串处理</span><br><span class="line">		#print line.strip()</span><br><span class="line">		ssid_name+&#x3D;1</span><br><span class="line">		if ssid_name-ssid_passwd&gt;&#x3D;2:</span><br><span class="line">			fp.write(&#39;\n&#39;)</span><br><span class="line">		fp.write(line.strip())</span><br><span class="line"></span><br><span class="line">	if r&#39;\xb9\xd8\xbc\xfc\xc4\xda\xc8\xdd&#39; in line :</span><br><span class="line">		#这里的16进制编码中文为&quot;关键内容&quot;，一般情况下无线网路密码均在这行</span><br><span class="line">		line&#x3D;line.replace(&#39;\&#39;&#39;,&#39;&#39;)</span><br><span class="line">		line&#x3D;line.replace(r&#39;\xb9\xd8\xbc\xfc\xc4\xda\xc8\xdd&#39;,&#39;&#39;)</span><br><span class="line">		#对无线网密码这行进行处理</span><br><span class="line">		#print line</span><br><span class="line">		ssid_passwd+&#x3D;1</span><br><span class="line">		fp.write(line)</span><br><span class="line"></span><br><span class="line">#这里在将无线网ID、密码写入文件时会出现这样一种状况，只有SSID名称，没有密码</span><br><span class="line">#因此可能会造成写入文件，一直写到无线网密码才转行，而前面可能堆积了很多没有密码的SSID 名称</span><br><span class="line">#这里给名称和密码做数字标记，当名称连续写入时作转行处理</span><br><span class="line"></span><br><span class="line">print &#39;无线历史记录已写入文件！&#39;</span><br><span class="line">wireless.kill()</span><br><span class="line">#将查询无线网信息的subprocess开启的进程关闭（前面很多进程未关闭）</span><br><span class="line"></span><br><span class="line">fp.close()</span><br><span class="line">#关闭文件</span><br></pre></td></tr></table></figure>

<h1 id="关于日志"><a href="#关于日志" class="headerlink" title="关于日志"></a>关于日志</h1><h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><p>Windows日志包括五个类别：</p>
<ul>
<li>应用程序</li>
<li>安全</li>
<li>Setup</li>
<li>系统</li>
<li>转发事件</li>
</ul>
<p><strong>查看方式：</strong></p>
<p><strong>1、</strong> 通过面板</p>
<p>位置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Control Panel\System and Security-View event logs-Windows Logs</span><br></pre></td></tr></table></figure>

<p><strong>2、</strong> 通过Powershell</p>
<p>常用命令如下：</p>
<p>(管理员权限)</p>
<p>查看所有日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-WinEvent</span><br></pre></td></tr></table></figure>

<p>查看应用程序类别下的日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-WinEvent -FilterHashtable @&#123;logname&#x3D;&quot;Application&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="事件ID"><a href="#事件ID" class="headerlink" title="事件ID"></a>事件ID</h2><table>
<thead>
<tr>
<th align="left">事件ID</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1102</td>
<td align="left">清理审计日志</td>
</tr>
<tr>
<td align="left">4624</td>
<td align="left">账号成功登录</td>
</tr>
<tr>
<td align="left">4625</td>
<td align="left">账号登录失败</td>
</tr>
<tr>
<td align="left">4768</td>
<td align="left">Kerberos身份验证（TGT请求）</td>
</tr>
<tr>
<td align="left">4769</td>
<td align="left">Kerberos服务票证请求</td>
</tr>
<tr>
<td align="left">4776</td>
<td align="left">NTLM身份验证</td>
</tr>
<tr>
<td align="left">4672</td>
<td align="left">授予特殊权限</td>
</tr>
<tr>
<td align="left">4720</td>
<td align="left">创建用户</td>
</tr>
<tr>
<td align="left">4726</td>
<td align="left">删除用户</td>
</tr>
<tr>
<td align="left">4728</td>
<td align="left">将成员添加到启用安全的全局组中</td>
</tr>
<tr>
<td align="left">4729</td>
<td align="left">将成员从安全的全局组中移除</td>
</tr>
<tr>
<td align="left">4732</td>
<td align="left">将成员添加到启用安全的本地组中</td>
</tr>
<tr>
<td align="left">4733</td>
<td align="left">将成员从启用安全的本地组中移除</td>
</tr>
<tr>
<td align="left">4756</td>
<td align="left">将成员添加到启用安全的通用组中</td>
</tr>
<tr>
<td align="left">4757</td>
<td align="left">将成员从启用安全的通用组中移除</td>
</tr>
<tr>
<td align="left">4719</td>
<td align="left">系统审计策略修改</td>
</tr>
</tbody></table>
<h2 id="删除日志的思路"><a href="#删除日志的思路" class="headerlink" title="删除日志的思路"></a>删除日志的思路</h2><p>分析事件记录格式后，了解到Windows系统在解析事件记录日志时，按照Event Record的大小逐条读取日志的内容。假设修改某条日志的长度，使长度覆盖下一条日志，理论上Windows系统解析日志时，就会跳过下一条日志，相当于下一条日志被”删除”。</p>
<p><strong>仅仅修改了程度，实际上并没有删除日志内容，还需要修改多个标志位和重新计算校验和。</strong></p>
<p>根据以上的方式进行删除单条日志是NAS方程式组织的DanderSpritz中的eventlogedit实现方式。实际上只是将信息进行了隐藏，在此基础上，将指定日志的内容清空，就能够实现真正的日志删除。</p>
<h2 id="恢复被删除的记录"><a href="#恢复被删除的记录" class="headerlink" title="恢复被删除的记录"></a>恢复被删除的记录</h2><p>使用以上的方式删除单挑记录，其实被删除的数据并没有真正的被删掉，严格意义上讲就是将部分数据进行了隐藏。恢复原本的数据可以使用fox-it的danderspritz-evtx工具，原因就是用删除数据的思路反向恢复就行。</p>
<h2 id="目前的办法"><a href="#目前的办法" class="headerlink" title="目前的办法"></a>目前的办法</h2><p>关于可能被删除的日志</p>
<p>可以用everything确认文件修改时间</p>
<h1 id="下午"><a href="#下午" class="headerlink" title="下午"></a>下午</h1><p>部分逆向知识，笔记本上</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/19/%E7%AC%AC%E4%BA%94%E5%91%A8/1.14/" data-id="ck5na8rty0009g4tw1jrudll7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第三周/1.3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/03/%E7%AC%AC%E4%B8%89%E5%91%A8/1.3/" class="article-date">
  <time datetime="2020-01-03T06:10:53.946Z" itemprop="datePublished">2020-01-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/03/%E7%AC%AC%E4%B8%89%E5%91%A8/1.3/">第三周/1.3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="关于Windows环境下的木马检测"><a href="#关于Windows环境下的木马检测" class="headerlink" title="关于Windows环境下的木马检测"></a>关于Windows环境下的木马检测</h1><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>首先对网络监控记录开放的端口和可疑的IP</p>
<p>然后通过可疑的进程、启动项，慢慢追踪到木马文件本身，将可疑的文件进行对比</p>
<p>再关联到其他的可疑行为，逐渐还原木马攻击流程</p>
<p>工具</p>
<p>ApateDNS、Currports、PCHunter、Autoruns、PowerTool、WinHex</p>
<h2 id="题目的解题流程"><a href="#题目的解题流程" class="headerlink" title="题目的解题流程"></a>题目的解题流程</h2><p>1.通过ApateDNS发现DNS劫持的IP，然后通过IP找到相应进程，再利用PID找到驻留文件等，最后排查注册表等可能包含的残留文件</p>
<p>2.查看端口，关注特殊端口，有些注册表修改的启动项不在msconfig中显示</p>
<h2 id="自己的解题流程"><a href="#自己的解题流程" class="headerlink" title="自己的解题流程"></a>自己的解题流程</h2><p>通过查看启动项和进程，找到了没有数字签名的系统服务，依次找到木马文件等可用信息</p>
<h1 id="今日渗透"><a href="#今日渗透" class="headerlink" title="今日渗透"></a>今日渗透</h1><h2 id="批量刷漏洞"><a href="#批量刷漏洞" class="headerlink" title="批量刷漏洞"></a>批量刷漏洞</h2><p>看了网上的资料，思路基本上是python爬取url利用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.nmd5.com&#x2F;?p&#x3D;204</span><br><span class="line"></span><br><span class="line">脚本：</span><br><span class="line">爬取网站整站的url的脚本原版 python2.x执行 脚本名：spider_allsite2.py    </span><br><span class="line">链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1RWW61TkOLuo-z3O1d1vrqA </span><br><span class="line">提取码：539q </span><br><span class="line"></span><br><span class="line">爬取网站100条的url的脚本 python2.x执行 脚本名：spider_allsite2_new.py</span><br><span class="line">链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1ykZFxnGNCWG_nZ0QvXDiRA </span><br><span class="line">提取码：xg0y </span><br><span class="line"></span><br><span class="line">通过搜索引擎site网站获取url的脚本 python3.x执行 脚本名：bing.py</span><br><span class="line">链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1K6uiSjatiE-DPYNLRGjBnQ </span><br><span class="line">提取码：piz1 </span><br><span class="line"></span><br><span class="line">多线程访问网站是否200状态 python3.x执行 脚本名：thread_open200.py</span><br><span class="line">链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1UV5oZwekMN7cOjjgfdk4pQ </span><br><span class="line">提取码：1x2e</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">爬取补天域名，对比一下自己写的</span><br><span class="line">http:&#x2F;&#x2F;www.nmd5.com&#x2F;?p&#x3D;170</span><br><span class="line"></span><br><span class="line">获取二级域名脚本</span><br><span class="line"></span><br><span class="line">def domain():</span><br><span class="line">    with open(&#39;360data.txt&#39;, &#39;a&#39;) as f0:</span><br><span class="line">        with open(&#39;360url.txt&#39;, &#39;r&#39;) as f1:</span><br><span class="line">            for url in f1.readlines():</span><br><span class="line">                print(url)</span><br><span class="line">                urls &#x3D; &quot;http:&#x2F;&#x2F;ce.baidu.com&#x2F;index&#x2F;getRelatedSites?site_address&#x3D;&quot;+url</span><br><span class="line">                opurl &#x3D; urllib.request.urlopen(urls)</span><br><span class="line">                data &#x3D; opurl.read().decode(&#39;utf-8&#39;)</span><br><span class="line">                f0.write(data)</span><br><span class="line">                print(data)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/03/%E7%AC%AC%E4%B8%89%E5%91%A8/1.3/" data-id="ck5na8rt10001g4tw37l55z56" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.9/">第四周/1.9</a>
          </li>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.8/">第四周/1.8</a>
          </li>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.7/">第四周/1.7</a>
          </li>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.6/">第四周/1.6</a>
          </li>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.10/">第四周/1.10</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 熊猫在路上<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>