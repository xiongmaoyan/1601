<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>1-20 | 熊猫在路上</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="CrackMe,逆向">
    <meta name="description" content="学习CrackMe练习题">
<meta property="og:type" content="article">
<meta property="og:title" content="1-20">
<meta property="og:url" content="https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/index.html">
<meta property="og:site_name" content="熊猫在路上">
<meta property="og:description" content="学习CrackMe练习题">
<meta property="og:locale" content="ch">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/6.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/7.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/8.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/9.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/1.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/2.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/3.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/4.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/5.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/11.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/10.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/12.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/13.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/14.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/15.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/16.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/17.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/18.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/19.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/20.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/21.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/22.png">
<meta property="og:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/23.png">
<meta property="article:published_time" content="2020-01-20T08:15:57.000Z">
<meta property="article:modified_time" content="2020-03-23T09:18:46.457Z">
<meta property="article:author" content="熊猫在路上">
<meta property="article:tag" content="CrackMe">
<meta property="article:tag" content="逆向">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.xt996.top/muggle/2020/01/20/1.20/6.png">
    
    <link rel="shortcut icon" href="/muggle/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/muggle/img/brand.jpg)">
      <div class="brand">
        <a href="/muggle/" class="avatar waves-effect waves-circle waves-light">
          <img src="/muggle/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">熊猫在路上</h5>
          <a href="mailto:2439046455@qq.com" title="2439046455@qq.com" class="mail">2439046455@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/muggle/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/muggle/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/muggle/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/muggle/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/xiongmaoyan" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/muggle/custom"  >
                <i class="icon icon-lg icon-link"></i>
                测试
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">1-20</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">1-20</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-01-20T08:15:57.000Z" itemprop="datePublished" class="page-time">
  2020-01-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/muggle/categories/%E6%AF%8F%E6%97%A5%E5%AD%A6%E4%B9%A0%E5%B0%8F%E7%BB%93/">每日学习小结</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#早报"><span class="post-toc-number">1.</span> <span class="post-toc-text">早报</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#freebuf"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">freebuf</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#CrackMe-003"><span class="post-toc-number">2.</span> <span class="post-toc-text">CrackMe-003</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#逆向学习"><span class="post-toc-number">3.</span> <span class="post-toc-text">逆向学习</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#工具"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">工具</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#闯关题目"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">闯关题目</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#第二关"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">第二关</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#算法部分"><span class="post-toc-number">3.3.1.</span> <span class="post-toc-text">算法部分</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#第三关"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">第三关</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#NAG部分"><span class="post-toc-number">3.4.1.</span> <span class="post-toc-text">NAG部分</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#爆破部分"><span class="post-toc-number">3.4.2.</span> <span class="post-toc-text">爆破部分</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#算法部分-1"><span class="post-toc-number">3.4.3.</span> <span class="post-toc-text">算法部分</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#宏病毒"><span class="post-toc-number">4.</span> <span class="post-toc-text">宏病毒</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基础知识"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">基础知识</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#VB基础"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">VB基础</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#工具检测"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">工具检测</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#防御手段"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">防御手段</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#禁用宏"><span class="post-toc-number">4.4.1.</span> <span class="post-toc-text">禁用宏</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#越过自动宏"><span class="post-toc-number">4.4.2.</span> <span class="post-toc-text">越过自动宏</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#CrackMe-004"><span class="post-toc-number">5.</span> <span class="post-toc-text">CrackMe-004</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#逆向学习-1"><span class="post-toc-number">6.</span> <span class="post-toc-text">逆向学习</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#工具-1"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">工具</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#闯关题目-1"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">闯关题目</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#第四关"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">第四关</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#爆破部分-1"><span class="post-toc-number">6.3.1.</span> <span class="post-toc-text">爆破部分</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#算法部分-2"><span class="post-toc-number">6.3.2.</span> <span class="post-toc-text">算法部分</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-1.20"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">1-20</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-01-20 16:15:57" datetime="2020-01-20T08:15:57.000Z"  itemprop="datePublished">2020-01-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/muggle/categories/%E6%AF%8F%E6%97%A5%E5%AD%A6%E4%B9%A0%E5%B0%8F%E7%BB%93/">每日学习小结</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>学习CrackMe练习题</p>
<a id="more"></a>



<h1 id="早报"><a href="#早报" class="headerlink" title="早报"></a>早报</h1><h2 id="freebuf"><a href="#freebuf" class="headerlink" title="freebuf"></a>freebuf</h2><p>内网渗透</p>
<blockquote>
<p><a href="https://www.freebuf.com/vuls/224507.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/224507.html</a></p>
</blockquote>
<h1 id="CrackMe-003"><a href="#CrackMe-003" class="headerlink" title="CrackMe-003"></a>CrackMe-003</h1><h1 id="逆向学习"><a href="#逆向学习" class="headerlink" title="逆向学习"></a>逆向学习</h1><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><blockquote>
<p>OllyDbg(OD)：<a href="https://www.52pojie.cn/thread-350397-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-350397-1-1.html</a><br>PEID：<a href="https://www.52pojie.cn/thread-170387-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-170387-1-1.html</a><br>Exeinfo PE：<a href="https://www.52pojie.cn/thread-437586-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-437586-1-1.html</a><br>樱花补丁制作工具：<a href="https://www.52pojie.cn/thread-62307-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-62307-1-1.html</a><br>内存补丁生成器：<a href="https://www.52pojie.cn/thread-162411-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-162411-1-1.html</a><br>注册机生成器：<a href="https://www.52pojie.cn/thread-159470-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-159470-1-1.html</a><br>IDA Pro v7：<a href="https://www.52pojie.cn/thread-675251-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-675251-1-1.html</a></p>
</blockquote>
<h2 id="闯关题目"><a href="#闯关题目" class="headerlink" title="闯关题目"></a>闯关题目</h2><blockquote>
<p>160个CrackMe的打包文件下载地址：<br>下载地址1：<a href="https://pan.baidu.com/s/1cySNkj9uENG_ppK80BmjUQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1cySNkj9uENG_ppK80BmjUQ</a> 密码：8d77<br>下载链接2：<a href="https://pan.baidu.com/s/150wDRlmXTQjwm2-ey-3I6Q" target="_blank" rel="noopener">https://pan.baidu.com/s/150wDRlmXTQjwm2-ey-3I6Q</a> 密码：qr21</p>
</blockquote>
<h2 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h2><h3 id="算法部分"><a href="#算法部分" class="headerlink" title="算法部分"></a>算法部分</h3><p>回到爆破的那个地方（大佬们都这么说，就是把je换成noop那一块）</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/6.png" alt="image-20200120094115100" title>
                </div>
                <div class="image-caption">image-20200120094115100</div>
            </figure>

<p>攻略的步骤反正我是没整明白（大佬求放过）我就自己一步一步往上走，设置断点，然后观察寄存器FPU，到了下面这步有了发现</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/7.png" alt="image-20200120094115100" title>
                </div>
                <div class="image-caption">image-20200120094115100</div>
            </figure>

<p>反正就是在这一步计算出了注册码，但是没有添加AKA头部，通过尝试发现确实是这样</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/8.png" alt="image-20200120094115100" title>
                </div>
                <div class="image-caption">image-20200120094115100</div>
            </figure>

<p>接下来就有思路了，往上看看注册码的算法</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/9.png" alt="image-20200120094115100" title>
                </div>
                <div class="image-caption">image-20200120094115100</div>
            </figure>

<p>emmm大致算法就这样吧，我也理不清了</p>
<h2 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h2><p>首先用工具查看一些基本的信息，可以看到编译程序是VB，没有壳</p>
<p><img src="http://www.xt996.top/muggle/2020/01/20/1.20/1.png" alt="image-20200120094115100"></p>
<p>原程序启动有一个NAG窗口，若干秒后会自动关闭，打开主窗口，这里看大佬们都是要去除NAG窗口然后开始操作，我也跟着来吧哈哈</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/2.png" alt="image-20200120094115100" title>
                </div>
                <div class="image-caption">image-20200120094115100</div>
            </figure>

<p>NAG窗口关闭后，进入主程序，长这个憨憨样子</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/3.png" alt="image-20200120094115100" title>
                </div>
                <div class="image-caption">image-20200120094115100</div>
            </figure>

<p>这里就自己随便测试，输入数字和字符的结果不太一样</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/4.png" alt="image-20200120094115100" title>
                </div>
                <div class="image-caption">image-20200120094115100</div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/5.png" alt="image-20200120094115100" title>
                </div>
                <div class="image-caption">image-20200120094115100</div>
            </figure>

<h3 id="NAG部分"><a href="#NAG部分" class="headerlink" title="NAG部分"></a>NAG部分</h3><p>接着就用OD打开分析，首先就要把那个头痛的NAG窗口去掉</p>
<p>VB程序有个特点-入口点处都是一个PUSH指令,然后一个CALL指令，看JMP 后面跟的MSVBVM50，应该是VB5.0编写的。(如果不是这种情况的话,那么该程序可能被加过壳)， PUSH将要压入堆栈的是004067D4,现在我们在数据窗口中定位到这个地址<code>右键--follow in Dump--Immediate constant</code>数据窗口中跟随–立即数</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/11.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>第一行PUSH后的<strong>立即数加4c</strong>得到406820作为跳转地址,00406820就在<code>68684000</code>，右键跟随</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/10.png" alt="10" title>
                </div>
                <div class="image-caption">10</div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/12.png" alt="image-20200120112119106" title>
                </div>
                <div class="image-caption">image-20200120112119106</div>
            </figure>

<p>跳转之后，将标记的<code>01</code>与<code>00</code>修改成<code>00</code>和<code>01</code>，在右键复制可执行文件，选择保存，即可</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/13.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/14.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/15.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<h3 id="爆破部分"><a href="#爆破部分" class="headerlink" title="爆破部分"></a>爆破部分</h3><p>用OD打开已经修改NAG的程序，还是经典操作哈哈</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/16.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>往上查找什么<code>jmp</code>或者<code>jn</code>的语句，直接选中JE语句，<code>右键-&gt;Binary-&gt;Fill with NOPs</code>. 试一试，OK，爆破成功。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/17.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/18.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<h3 id="算法部分-1"><a href="#算法部分-1" class="headerlink" title="算法部分"></a>算法部分</h3><p>感觉每次最难的地方就是算法，就引用大佬的思路吧（头大）</p>
<p>这个程序和002基本一样的，在跳转附近无任何和Name/Serial相关的内容，所以，向上找到这段代码的开头，下断，一路F8记录重要信息。</p>
<p><strong>PS：由于这个代码太长，只将重要片段拿出来。查找开头时不要急，代码真的很长。需要特别注意和Name/Serial相关的部分。</strong></p>
<p>出现Serial</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">004085C8   .  FF15 18B14000 call dword ptr ds:[&lt;&amp;MSVBVM50.__vbaHresu&gt;;  msvbvm50.__vbaHresultCheckObj</span><br><span class="line">004085CE   &gt;  8B45 E8       mov eax,dword ptr ss:[ebp-0x18]</span><br><span class="line">004085D1   .  50            push eax                                 ;  &#x2F;&#x2F; 获取Serial</span><br><span class="line">004085D2   .  FF15 74B14000 call dword ptr ds:[&lt;&amp;MSVBVM50.__vbaR8Str&gt;;  msvbvm50.__vbaR8Str</span><br><span class="line">004085D8   .  8B4D E4       mov ecx,dword ptr ss:[ebp-0x1C]          ;  &#x2F;&#x2F; 1066828</span><br><span class="line">004085DB   .  DD9D 1CFFFFFF fstp qword ptr ss:[ebp-0xE4]</span><br><span class="line">004085E1   .  51            push ecx</span><br><span class="line">004085E2   .  FF15 74B14000 call dword ptr ds:[&lt;&amp;MSVBVM50.__vbaR8Str&gt;;  msvbvm50.__vbaR8Str</span><br><span class="line">004085E8   .  833D 00904000&gt;cmp dword ptr ds:[0x409000],0x0</span><br><span class="line">004085EF   .  75 08         jnz short 004085F9</span><br><span class="line">004085F1   .  DCBD 1CFFFFFF fdivr qword ptr ss:[ebp-0xE4]            ;  &#x2F;&#x2F; 做除法</span><br><span class="line">004085F7   .  EB 11         jmp short 0040860A</span><br><span class="line">004085F9   &gt; \FFB5 20FFFFFF push dword ptr ss:[ebp-0xE0]</span><br><span class="line">004085FF   .  FFB5 1CFFFFFF push dword ptr ss:[ebp-0xE4]</span><br><span class="line">00408605   .  E8 888AFFFF   call &lt;jmp.&amp;MSVBVM50._adj_fdivr_m64&gt;</span><br><span class="line">0040860A   &gt;  DFE0          fstsw ax                                 ;  &#x2F;&#x2F; 把结果送入ax</span><br><span class="line">0040860C   .  A8 0D         test al,0xD</span><br><span class="line">0040860E   .  0F85 AB010000 jnz 004087BF</span><br><span class="line">00408614   .  FF15 34B14000 call dword ptr ds:[&lt;&amp;MSVBVM50.__vbaFpR8&gt;&gt;;  msvbvm50.__vbaFpR8</span><br><span class="line">0040861A   .  DC1D 28104000 fcomp qword ptr ds:[0x401028]</span><br><span class="line">00408620   .  DFE0          fstsw ax                                 ;  &#x2F;&#x2F;ax&#x3D;20</span><br><span class="line">00408622   .  F6C4 40       test ah,0x40                             ;  &#x2F;&#x2F; ah&#x3D;40</span><br><span class="line">00408625   .  74 07         je short 0040862E</span><br></pre></td></tr></table></figure>

<p>后面做的除法运算和取反，为了处理esi的值，然后做为JE的条件。我们到这里其实就可以试试算出来的字符串“1066828”是否是正确的？哈哈，他肯定是的啦！</p>
<p>至此，序列号的生成过程已经分析完毕。过程中设计到的常量都是使用[0040100A]等固定地址得到的固定值，不用理会，我们可以直接使用。</p>
<p><strong>小结一下：先计算出Name的长度nLen,然后edi=edi*0x15B38+cName, cName是Name第一个字符的ANSI码。然后，计算浮点数10.0/5.0=2.0, edi转换为浮点数，加上2.0，然后结果再乘以3.0，然后减去2，然后再减去-15，得到的值转换为文本，即为正确的序列号。</strong></p>
<h1 id="宏病毒"><a href="#宏病毒" class="headerlink" title="宏病毒"></a>宏病毒</h1><p>学习目录</p>
<blockquote>
<p><a href="https://bbs.ichunqiu.com/forum.php?mod=collection&amp;action=view&amp;ctid=133" target="_blank" rel="noopener">https://bbs.ichunqiu.com/forum.php?mod=collection&amp;action=view&amp;ctid=133</a></p>
</blockquote>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>宏就是把一系列的指令组织成一独立的命令，类似C语言中#define宏定义，避免同一动作的一再重复</p>
<p>我们大多接触到的宏或者说大多数攻击是在office文档中的宏病毒，由于wps只有专业版才会带有宏功能，所以office的攻击相对来说多一点</p>
<p>使用office文档文件(demo1.doc)时，有时候我们会遇到“安全警告”，这说明该文档文件中含有宏，并且office软件设置了“宏禁用”功能。</p>
<p>我们可以用快捷键Alt+F11可以打开vb编辑器，查看宏代码</p>
<p>宏病毒的强大是建立在强大的VBA组件的基础上的。同时，宏病毒与系统平台无关，任何计算机如果能够运行Microsoft Office办公软件，都有可能感染宏病毒</p>
<h2 id="VB基础"><a href="#VB基础" class="headerlink" title="VB基础"></a>VB基础</h2><p>宏是使用VB语言编写的，所以我们要了解一点VB的基础函数，先看一段代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Sub autoopen()</span><br><span class="line">b</span><br><span class="line">End Sub</span><br><span class="line">Function b()</span><br><span class="line">MsgBox ActiveDocument.BuiltInDocumentProperties(5)</span><br><span class="line">End Function</span><br></pre></td></tr></table></figure>

<p>（1）sub与function</p>
<p>上述宏代码中，含有一个Sub和一个Function。sub和function都类似于C中的函数。sub在VB中被称为过程，function被称为函数；sub没有返回值，function有返回值；一段宏一定是从sub开始执行的。在demo3中定义了一个过程 autoopen()，“End Sub”表示这个过程的结束。</p>
<p>（2）VB基本函数</p>
<p>“MsgBox ActiveDocument.BuiltInDocumentProperties(5)”调用了VB基本函数“MsgBox”，</p>
<p>参数是”ActiveDocument.BuiltInDocumentProperties(5)”。这里实际上是“MsgBox (参数)”，但是VBA的容错率较高，不写括号，宏代码依然能够执行。即使我们将“MsgBox”写成“MSgbOx”，宏代码依然能够执行。一些宏病毒就是使用大小写混淆，增加病毒分析难度。</p>
<p>除了MsgBox，VB中还有很多基本函数，各位可以百度“VB函数大全”。</p>
<p>（3）对象</p>
<p>VB中存在很多对象，如Application对象，Document对象，Adobd.stream对象等。对象实际上是代码和数据的组合，我们在使用对象时，要么使用对象的属性（就是数据），要么使用对象的方法（就是代码）。通过 “对象.属性/方法”的方式使用对象的属性/方法。ActiveDocument.BuiltInDocumentProperties(5)中就是使用了ActiveDocument对象的BuiltInDocumentProperties()方法，参数是5</p>
<h2 id="工具检测"><a href="#工具检测" class="headerlink" title="工具检测"></a>工具检测</h2><p>oledump.py是一个用于分析OLE文件（复合文件二进制格式）的程序，我们可以使用它提取文档中的宏代码</p>
<blockquote>
<p><a href="https://github.com/decalage2/oledump-contrib" target="_blank" rel="noopener">https://github.com/decalage2/oledump-contrib</a></p>
</blockquote>
<p>安装的问题，需要模块olefile，下载压缩包，运行python setup.py install（都在hong目录下，压缩包也在里面）</p>
<blockquote>
<p><a href="https://bitbucket.org/decalage/olefileio_pl/wiki/Install" target="_blank" rel="noopener">https://bitbucket.org/decalage/olefileio_pl/wiki/Install</a></p>
</blockquote>
<p>oledump.py有许多参数可以选择，使用oledump.py -m 可以查看oledump.py 的帮助信息，这里我们要用到的参数是-s和-v</p>
<p>-s 段号：选择上分析出的某一段来查看内容</p>
<p>-v        ：解压缩VBA宏</p>
<p>上面两个参数结合起来用就可以找出宏源码</p>
<p>在实际分析时，-s后的参数可以选择‘a’，表示分析所有段的数据，还可以使用‘&gt;’符号将宏代码数据存储在新文件</p>
<h2 id="防御手段"><a href="#防御手段" class="headerlink" title="防御手段"></a>防御手段</h2><h3 id="禁用宏"><a href="#禁用宏" class="headerlink" title="禁用宏"></a>禁用宏</h3><p>以word2013为例，禁用宏的方法是：单击开发工具菜单下的“宏”，单击“宏安全性”，在随后的出现的对话框中选择“禁用所有宏，并发出通知”</p>
<p>缺陷：一是它拒绝了一切的宏执行，并不区分正常的宏和还是病毒宏，这会造成某些文档无法打开或出错；二是宏病毒防护无法阻止启动word时Autoexec.DOT中的宏和Normal.DOT中的宏自动执行</p>
<h3 id="越过自动宏"><a href="#越过自动宏" class="headerlink" title="越过自动宏"></a>越过自动宏</h3><p>始终按住SHift键，将禁止存在的一起自动宏</p>
<h1 id="CrackMe-004"><a href="#CrackMe-004" class="headerlink" title="CrackMe-004"></a>CrackMe-004</h1><h1 id="逆向学习-1"><a href="#逆向学习-1" class="headerlink" title="逆向学习"></a>逆向学习</h1><h2 id="工具-1"><a href="#工具-1" class="headerlink" title="工具"></a>工具</h2><blockquote>
<p>OllyDbg(OD)：<a href="https://www.52pojie.cn/thread-350397-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-350397-1-1.html</a><br>PEID：<a href="https://www.52pojie.cn/thread-170387-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-170387-1-1.html</a><br>Exeinfo PE：<a href="https://www.52pojie.cn/thread-437586-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-437586-1-1.html</a><br>樱花补丁制作工具：<a href="https://www.52pojie.cn/thread-62307-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-62307-1-1.html</a><br>内存补丁生成器：<a href="https://www.52pojie.cn/thread-162411-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-162411-1-1.html</a><br>注册机生成器：<a href="https://www.52pojie.cn/thread-159470-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-159470-1-1.html</a><br>IDA Pro v7：<a href="https://www.52pojie.cn/thread-675251-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-675251-1-1.html</a></p>
</blockquote>
<h2 id="闯关题目-1"><a href="#闯关题目-1" class="headerlink" title="闯关题目"></a>闯关题目</h2><blockquote>
<p>160个CrackMe的打包文件下载地址：<br>下载地址1：<a href="https://pan.baidu.com/s/1cySNkj9uENG_ppK80BmjUQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1cySNkj9uENG_ppK80BmjUQ</a> 密码：8d77<br>下载链接2：<a href="https://pan.baidu.com/s/150wDRlmXTQjwm2-ey-3I6Q" target="_blank" rel="noopener">https://pan.baidu.com/s/150wDRlmXTQjwm2-ey-3I6Q</a> 密码：qr21</p>
</blockquote>
<h2 id="第四关"><a href="#第四关" class="headerlink" title="第四关"></a>第四关</h2><p>首先老套路，先看有没有壳在大致看看程序本体，这里有个txt提供了部分信息（没有确定键、成功之后会有图片提示）</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/19.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>查壳，emmmm无壳</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/20.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<h3 id="爆破部分-1"><a href="#爆破部分-1" class="headerlink" title="爆破部分"></a>爆破部分</h3><p>emmm这题没有确定键没有提交，跟前面几题不太像，直接<code>右键--搜索中文搜索引擎--智能搜索</code>搜索<code>注册成功</code>等字样</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/21.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>然后就是老套路了，往上翻翻特殊跳转语句，上面几行就有一个<code>jnz</code>但是它是往上的，继续往上看找到两个跳转，<code>0045803B</code>有点特殊直接跳过了<code>恭喜恭喜！注册成功</code>，可能就是这里了吧</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/22.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>果断nop，哈哈果然成功</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.xt996.top/muggle/2020/01/20/1.20/23.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>



<h3 id="算法部分-2"><a href="#算法部分-2" class="headerlink" title="算法部分"></a>算法部分</h3><p>接下来就头大了，又不知道要找多久</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-03-23T09:18:46.457Z" itemprop="dateUpdated">2020-03-23 17:18:46</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/muggle/2020/01/20/1.20/" target="_blank" rel="external">https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/</a>
        
    </div>
    
    <footer>
        <a href="https://xiongmaozailushang.gitee.io/muggle">
            <img src="/muggle/img/avatar.jpg" alt="熊猫在路上">
            熊猫在路上
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/muggle/tags/CrackMe/" rel="tag">CrackMe</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/muggle/tags/%E9%80%86%E5%90%91/" rel="tag">逆向</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/&title=《1-20》 — 熊猫在路上&pic=https://xiongmaozailushang.gitee.io/muggle/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/&title=《1-20》 — 熊猫在路上&source=学习CrackMe练习题" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《1-20》 — 熊猫在路上&url=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/&via=https://xiongmaozailushang.gitee.io/muggle" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/muggle/2020/01/21/no-1/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">666</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/muggle/2020/01/19/1.19/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">木马相关</h4>
      </a>
    </div>
  
</nav>



    




















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/muggle/false" alt="打赏二维码">
        </div>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>熊猫在路上 &copy; 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> 网站备案号： <a href="https://www.beian.miit.gov.cn" target="_blank">湘ICP备19018331号</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/&title=《1-20》 — 熊猫在路上&pic=https://xiongmaozailushang.gitee.io/muggle/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/&title=《1-20》 — 熊猫在路上&source=学习CrackMe练习题" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《1-20》 — 熊猫在路上&url=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/&via=https://xiongmaozailushang.gitee.io/muggle" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://xiongmaozailushang.gitee.io/muggle/2020/01/20/1.20/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/muggle/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '熊猫已经不再路上了！';
            clearTimeout(titleTime);
        } else {
            document.title = '熊猫在路上!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
