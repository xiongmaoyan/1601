<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>熊猫在路上</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="熊猫在路上">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="熊猫在路上">
<meta property="og:locale" content="ch">
<meta property="article:author" content="熊猫在路上">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="熊猫在路上" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">熊猫在路上</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-第三周/1.2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/02/%E7%AC%AC%E4%B8%89%E5%91%A8/1.2/" class="article-date">
  <time datetime="2020-01-02T00:56:49.841Z" itemprop="datePublished">2020-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/02/%E7%AC%AC%E4%B8%89%E5%91%A8/1.2/">第三周/1.2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h3 id="墨者的日志分析"><a href="#墨者的日志分析" class="headerlink" title="墨者的日志分析"></a>墨者的日志分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.mozhe.cn&#x2F;bug&#x2F;detail&#x2F;QWVEWUJjbno0WURjS1RvU0pIRyt0UT09bW96aGUmozhe</span><br></pre></td></tr></table></figure>

<p>安全工程师拿到一个日志，里面有一条上传木马的记录，找到那个上传黑客的ip</p>
<p>1、掌握nginx的日志结构；</p>
<p>2、了解上传文件的请求方式；</p>
<p>上传木马的记录，初步怀疑是一句话木马</p>
<p>提交方式为POST</p>
<p>思路应该是 利用正则匹配POST开头带有php或者常见的一句话后缀</p>
<p>在日志里搜索<code>post /uploads</code>，就可以看到攻击者的IP，提交获取flag</p>
<h3 id="webshell访问特征"><a href="#webshell访问特征" class="headerlink" title="webshell访问特征"></a>webshell访问特征</h3><p>webshell的访问特征(主要特征)</p>
<ol>
<li>少量ip对其发起访问</li>
<li>总的访问次数少</li>
<li>该页面属于孤立页面</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">参考链接</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_34235371&#x2F;article&#x2F;details&#x2F;91884144</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;he1m4n6a&#x2F;p&#x2F;9245155.html</span><br><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;183520.html</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;tennc&#x2F;webshell</span><br></pre></td></tr></table></figure>

<p>当然不是所有的孤立页面都是webshell，以下情况也会造成孤立页面<br>（1）隐藏管理后台等正常孤立页面的访问<br>（2）扫描器行为，常见漏洞扫描，PoC扫描，Webshell扫描（日志中经常可以看到常见webshell路径加一句话payload的扫描）——这是最主要的干扰数据，需要剔除<br>对于情况（1）采用白名单的方式，对于情况（2）扫描器识别<br>（p.s. 爬虫技术、指纹识别技术、扫描器识别（广义的可衍生到人机识别）可以称为web安全技术的三驾马车，总也绕不过去）</p>
<p>优点：采用了一定数据分析的方式，网站的访问量达到一定量级时这种检测方法的结果具有较大参考价值。</p>
<p>缺点：存在一定误报，对于大量的访问日志，检测工具的处理能力和效率会比较低。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">正常来说，一般都是通过webshell扫描工具找到webshell，以上是基于流量分析，在只有日志的环境下，可以通过统计上传、访问次数，来重点标记特征IP。再判断上传请求的方式来找到攻击者IP</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/02/%E7%AC%AC%E4%B8%89%E5%91%A8/1.2/" data-id="ck5kmexjf0000k0tweg9uemjb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第三周/12.31" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/31/%E7%AC%AC%E4%B8%89%E5%91%A8/12.31/" class="article-date">
  <time datetime="2019-12-31T01:05:20.653Z" itemprop="datePublished">2019-12-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/31/%E7%AC%AC%E4%B8%89%E5%91%A8/12.31/">第三周/12.31</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="DOS命令"><a href="#DOS命令" class="headerlink" title="DOS命令"></a>DOS命令</h1><h2 id="DOS使用常识"><a href="#DOS使用常识" class="headerlink" title="DOS使用常识"></a>DOS使用常识</h2><h3 id="DOS的概况"><a href="#DOS的概况" class="headerlink" title="DOS的概况"></a>DOS的概况</h3><p>DOS（Disk Operating System）是一个使用得十分广泛的磁盘操作系统，就连眼下流行的Windows9x/ME系统都是以它为基础。</p>
<p>常见的DOS有两种：IBM公司的PC-DOS和微软公司的MS-DOS，它们的功能、命令用途格式都相同，我们常用的是MS-DOS。</p>
<h2 id="DOS常用命令"><a href="#DOS常用命令" class="headerlink" title="DOS常用命令"></a>DOS常用命令</h2><p>dir    显示目录</p>
<p>path    设置可执行文件的搜索路径，只对文件有效，只一次性生效</p>
<p>tree /a /f    打印文件树形结构</p>
<p>tasklist    显示进程</p>
<p>netstat -ano 显示端口信息</p>
<p>ver winver    显示系统版本</p>
<p>cls    清屏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">net use \\ip\ipc$ &quot; &quot; &#x2F;user:&quot; &quot; 建立ipc空链接</span><br><span class="line"></span><br><span class="line">net use \\ip\ipc$ &quot;密码&quot; &#x2F;user:&quot;用户名&quot; 建立ipc非空链接</span><br><span class="line"></span><br><span class="line">net use h: \\ip\c$ &quot;密码&quot; &#x2F;user:&quot;用户名&quot; 直接登陆后映射对方c：到本地为h:</span><br><span class="line"></span><br><span class="line">net use h: \\ip\c$ 登陆后映射对方c：到本地为h:</span><br><span class="line"></span><br><span class="line">net use \\ip\ipc$ &#x2F;del 删除ipc链接</span><br><span class="line"></span><br><span class="line">net use h: &#x2F;del 删除映射对方到本地的为h：的映射</span><br><span class="line"></span><br><span class="line">net user 用户名 密码 &#x2F;add 建立用户</span><br><span class="line"></span><br><span class="line">net user guest &#x2F;active:yes 激活guest用户</span><br><span class="line"></span><br><span class="line">net user 查看有哪些用户</span><br><span class="line"></span><br><span class="line">net user 帐户名 查看帐户的属性</span><br><span class="line"></span><br><span class="line">net localgroup ***istrators 用户名 &#x2F;add 把“用户”添加到管理员中使其具有管理员权限，注意：***istrator后加s用复数</span><br><span class="line"></span><br><span class="line">net time \\目标ip 查看对方时间</span><br><span class="line"></span><br><span class="line">net time \\目标ip &#x2F;set 设置本地计算机时间与“目标ip”主机的时间同步，加上参数&#x2F;yes可取消确认信息</span><br><span class="line"></span><br><span class="line">net view 查看本地局域网内开启了哪些共享</span><br><span class="line"></span><br><span class="line">net view \\ip 查看对方局域网内开启了哪些共享</span><br><span class="line"></span><br><span class="line">net config 显示系统网络设置</span><br><span class="line"></span><br><span class="line">net logoff 断开连接的共享</span><br><span class="line"></span><br><span class="line">net pause 服务名 暂停某服务</span><br><span class="line"></span><br><span class="line">net send ip &quot;文本信息&quot; 向对方发信息</span><br><span class="line"></span><br><span class="line">net ver 局域网内正在使用的网络连接类型和信息</span><br><span class="line"></span><br><span class="line">net share 查看本地开启的共享</span><br><span class="line"></span><br><span class="line">net share ipc$ 开启ipc$共享</span><br><span class="line"></span><br><span class="line">net share ipc$ &#x2F;del 删除ipc$共享</span><br><span class="line"></span><br><span class="line">net share c$ &#x2F;del 删除c：共享</span><br><span class="line"></span><br><span class="line">net user guest 12345 用guest用户登陆后用将密码改为12345net password 密码 更改系统登陆密码</span><br><span class="line"></span><br><span class="line">nbtstat -a ip 对方136到139其中一个端口开了的话，就可查看对方最近登陆的用户名（03前的为用户名）-注意：参数-a要大写</span><br><span class="line"></span><br><span class="line">tracert -参数 ip（或计算机名） 跟踪路由（数据包），参数：“-w数字”用于设置超时间隔。</span><br><span class="line"></span><br><span class="line">ping ip（或域名） 向对方主机发送默认大小为32字节的数据，参数：“-l[空格]数据包大小”；“-n发送数据次数”；“-t”指一直ping。</span><br><span class="line"></span><br><span class="line">ping -t -l 65500 ip 死亡之ping（发送大于64k的文件并一直ping就成了死亡之ping)</span><br><span class="line"></span><br><span class="line">ipconfig (winipcfg) 用于windows nt及xp(windows 95 98）查看本地ip地址，</span><br><span class="line"></span><br><span class="line">ipconfig可用参数“&#x2F;all”显示全部配置信息</span><br><span class="line"></span><br><span class="line">tlist -t 以树行列表显示进程（为系统的附加工具，默认是没有安装的，在安装目录的support&#x2F;tools文件夹内）</span><br><span class="line"></span><br><span class="line">kill -f 进程名 加-f参数后强制结束某进程（为系统的附加工具，默认是没有安装的，在安装目录的support&#x2F;tools文件夹内）</span><br><span class="line"></span><br><span class="line">del -f 文件名加-f参数后就可删除只读文件,&#x2F;ar、&#x2F;ah、&#x2F;as、&#x2F;aa分别表示删除只读、隐藏、系统、存档文件，&#x2F;a-r、&#x2F;a-h、&#x2F;a-s、&#x2F;a-a表示删除除只读、隐藏、系统、存档以外的文件。例如“del&#x2F;ar *.*”表示删除当前目录下所有只读文件，“del&#x2F;a-s *.*”表示删除当前目录下除系统文件以外的所有文件</span><br><span class="line"></span><br><span class="line"> TASKKILL &#x2F;IM notepad.exe</span><br><span class="line"> TASKKILL &#x2F;PID 1230 &#x2F;PID 1241 &#x2F;PID 1253 &#x2F;T</span><br><span class="line"> TASKKILL &#x2F;F &#x2F;IM cmd.exe &#x2F;T</span><br><span class="line"> TASKKILL &#x2F;F &#x2F;FI &quot;PID ge 1000&quot; &#x2F;FI &quot;WINDOWTITLE ne untitle*&quot;</span><br><span class="line"> TASKKILL &#x2F;F &#x2F;FI &quot;USERNAME eq NT AUTHORITY\SYSTEM&quot; &#x2F;IM notepad.exe</span><br><span class="line"> TASKKILL &#x2F;S system &#x2F;U domain\username &#x2F;FI &quot;USERNAME ne NT*&quot; &#x2F;IM *</span><br><span class="line"> TASKKILL &#x2F;S system &#x2F;U username &#x2F;P password &#x2F;FI &quot;IMAGENAME eq note*&quot;</span><br></pre></td></tr></table></figure>

<h3 id="查看服务"><a href="#查看服务" class="headerlink" title="查看服务"></a>查看服务</h3><p>SC 是用于与服务控制管理器和服务进行通信的命令行程序。</p>
<p>查询服务状态</p>
<p><strong>sc qc 服务名</strong></p>
<p>停止服务</p>
<p><strong>net stop 服务名</strong></p>
<p>删除服务</p>
<p><strong>sc delete 服务名</strong></p>
<h3 id="查看端口"><a href="#查看端口" class="headerlink" title="查看端口"></a>查看端口</h3><p>net start 查看开启了哪些服务net start 服务名 开启服务；（如：net start telnet，</p>
<p>net start schedule)net stop 服务名 停止某服务</p>
<p>netstat -a 查看开启了哪些端口，常用</p>
<p>netstat -annetstat -n 查看端口的网络连接情况，常用</p>
<p>netstat -annetstat -v 查看正在进行的工作</p>
<p>netstat -p 协议名 例：netstat -p tcp/ip 查看某协议使用情况（查看tcp/ip协议使用情况）</p>
<p>netstat -s 查看正在使用的所有协议使用情况</p>
<h2 id="渗透相关命令"><a href="#渗透相关命令" class="headerlink" title="渗透相关命令"></a>渗透相关命令</h2><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>arp -a</td>
<td>查看最近一次arp得到的局域网中的主机</td>
</tr>
<tr>
<td>systeminfo</td>
<td>查看主机的详细信息（包含已经打过的补丁）</td>
</tr>
<tr>
<td>cls</td>
<td>清屏</td>
</tr>
<tr>
<td>color XY</td>
<td>调整cmd窗口的颜色，X调整的是背景颜色，Y调整的是字体的颜色。具体颜色的代表符号可用 color –help 查询。当只有一个选项时调整的字体的颜色。</td>
</tr>
<tr>
<td>net view</td>
<td>查看局域网中的主机名</td>
</tr>
<tr>
<td>msg</td>
<td>向电脑中某个账户发消息。如：msg xxx “Hello”  xxx代表的是账户的名称。</td>
</tr>
<tr>
<td>ipconfig</td>
<td>查看主机的IP信息</td>
</tr>
<tr>
<td>shutdown</td>
<td>shutdown -s -t X -c “Hello” 执行定时关机命令并且显示Hello，X代表剩余关机的秒数，如果不想显示可不用 -c ，shutdown -a 取消定时关机。</td>
</tr>
<tr>
<td>netstat</td>
<td>查看本机各端口的连接情况，netstat -an 能够显示所有的连接和端口号。</td>
</tr>
<tr>
<td>dir</td>
<td>查看当前的目录，如果带有<dir>代表的是文件夹，没有代表的是文件。</td>
</tr>
<tr>
<td>start</td>
<td>打开某个文件（会自动判断用什么打开），但是名字要打全，可用tab键补全。</td>
</tr>
<tr>
<td>copy</td>
<td>复制命令，格式：copy X:\xxx d:\ 将X盘的xxx复制到d盘下。</td>
</tr>
<tr>
<td>del</td>
<td>删除命令，格式: del d:\xxx 将d盘下的xxx删除。</td>
</tr>
<tr>
<td>md</td>
<td>创建文件夹，可以递归创建。</td>
</tr>
<tr>
<td>rd</td>
<td>删除文件夹 ，递归删除文件夹格式: rd /s /q d:\xxx\xx\x  ,用递归删除命令的时候可以不加 /q 加上/q的话再删除的时候不用确认。</td>
</tr>
<tr>
<td>copy con</td>
<td>创建文件后能够在cmd中直接写文件，写完之后CTRL+z 退出。</td>
</tr>
<tr>
<td>type</td>
<td>在命令行中查看文件</td>
</tr>
<tr>
<td>ren</td>
<td>重命名，格式：ren 原文件名字 新文件名字</td>
</tr>
<tr>
<td>move</td>
<td>移动文件，格式: move s:\xxx.txt d:\  将s盘下的xxx.txt 移动到d盘</td>
</tr>
<tr>
<td>tree</td>
<td>查看树形结构</td>
</tr>
<tr>
<td>telent</td>
<td>远程连接，如果显示错误是本地的telnet客户端没有安装。解决方案：win+R—control—程序—启用或者关闭windows功能—找到telnet客户端（记住是客户端！！）—勾选—确定。格式：telnet IP地址</td>
</tr>
<tr>
<td>net start</td>
<td>查看已经打开的服务</td>
</tr>
<tr>
<td>net user</td>
<td>查看电脑创建的用户。 net user xx password /add 添加xxx用户密码为password。</td>
</tr>
<tr>
<td>net localgroup</td>
<td>查看当前的用户组有哪些。用法： net localgroup Administrators xxx /add 将xxx添加到管理员组。</td>
</tr>
<tr>
<td>net use</td>
<td>磁盘映射。 格式：net use K:\ 目的ip\c:$将目的ip电脑的c盘映射到本地为k盘。</td>
</tr>
<tr>
<td>taskkill</td>
<td>查看系统进程。taskkill /im xxx  将xxx进程结束。</td>
</tr>
<tr>
<td>schtasks.exe(at)</td>
<td>查看系统计划。我的电脑显示at命令已经弃用。</td>
</tr>
<tr>
<td>attrib</td>
<td>查看文件的属性。</td>
</tr>
</tbody></table>
<h3 id="域渗透命令"><a href="#域渗透命令" class="headerlink" title="域渗透命令"></a>域渗透命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">内网渗透</span><br><span class="line">https:&#x2F;&#x2F;www.anquanke.com&#x2F;post&#x2F;id&#x2F;193431</span><br></pre></td></tr></table></figure>



<p>ipconfig /all</p>
<p>//可以查看到当前网卡配置信息，包括所属域以及IP段</p>
<p>net view /domain:testdomain（testdomain 假设为目标的其中一个域）</p>
<p>//此命令是查看 testdomain域中的计算机列表</p>
<p>net view</p>
<p>//显示正由指定的计算机共享的域、计算机或资源的列表。如果在没有参数的情况下使用，则 net view 显示当前域中的计算机列表。</p>
<p>ping 机器名</p>
<p>//显示该机器名的IP</p>
<p>net view /domain</p>
<p>//查看有多少域</p>
<p>net user /domain</p>
<p>//获取所有域用户列表</p>
<p>net group /domain</p>
<p>//获取域用户组信息</p>
<p>net group “domain admins” /domain</p>
<p>//获取当前域管理员列表</p>
<p>net user domain-admin /domain</p>
<p>//查看管理员登陆时间，密码过期时间，是否有登陆脚本，组分配等信息！</p>
<p>net time /domain</p>
<p>//可以查看域时间，以及域服务器的名字（快速查找域的方法之一 By LCX）</p>
<p>net user /domain</p>
<p>//显示所有域用户</p>
<p>net user hack hack /add /domain</p>
<p>//添加普通域用户</p>
<p>net group “Domain Admins” hack /add /domain</p>
<p>//将 普通域用户 提升为域管理员</p>
<p>query user</p>
<p>查看是否有管理员在线</p>
<p>输入命令：logoff 1<br>把id为1的管理员踢下线（就是注销）</p>
<h3 id="内网渗透思路"><a href="#内网渗透思路" class="headerlink" title="内网渗透思路"></a>内网渗透思路</h3><p>攻击者做内网渗透时，思路通常是先获取了工作组的administrator权限，然后渗透配置不严格的域环境，开启powershell的remoting功能，powershell 2.0的Remoting默认会走<code>5985(HTTP)</code>和<code>5986(HTTPS)</code>端口，文章里说，主要是监控内网&lt;-&gt;内网，DMZ&lt;-&gt;内网,VPN&lt;-&gt;内网的异常数据流，建模识别出攻击者的非法访问，我想这里能做的，还是要熟悉内网环境，在有正常业务流的内网使用Remoting功能，其他办法我也没想到。</p>
<h3 id="绕过注入整理"><a href="#绕过注入整理" class="headerlink" title="绕过注入整理"></a>绕过注入整理</h3><p>参考</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;devi1o&#x2F;articles&#x2F;4896854.html</span><br></pre></td></tr></table></figure>


<p>and update delete ; insert mid master<br>1、运用编码技术绕过<br>如URLEncode编码，ASCII编码绕过。例如or 1=1即<br>%6f%72%20%31%3d%31，而Test也可以为CHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)。</p>
<p>2、通过空格绕过<br>如两个空格代替一个空格，用Tab代替空格等，或者删除所有空格，如<br>or’ swords’ =‘swords’ 必须用字符串，否则不用空格会出错<br>3、运用字符串判断代替<br>用经典的or 1=1判断绕过,如<br>or ‘swords’ =’swords’</p>
<p>这个方法就是网上在讨论的。<br>4、通过类型转换修饰符N绕过<br>可以说这是一个不错的想法，他除了能在某种程度上绕过限制，而且还有别的作用，大家自己好好想想吧。关于利用，如or ‘swords’ = N’ swords’ ，大写的N告诉mssql server 字符串作为nvarchar类型，它起到类型转换的作用，并不影响注射语句本身，但是可以避过基于知识的模式匹配IDS。<br>5、通过+号拆解字符串绕过<br>效果值得考证，但毕竟是一种方法。如<br>or ‘swords’ =‘sw’ +’ ords’ ；EXEC(‘IN’ +’ SERT INTO ‘+’ …..’ )</p>
<p>6、通过LIKE绕过<br>以前怎么就没想到呢?如or<br>‘swords’ LIKE ‘sw’</p>
<p>显然可以很轻松的绕过<br>“=”“&gt;”</p>
<p>的限制……<br>7、通过IN绕过<br>与上面的LIKE的思路差不多,如<br>or ‘swords’ IN (‘swords’)</p>
<p>8、通过BETWEEN绕过<br>如<br>or ‘swords’ BETWEEN ‘rw’ AND ‘tw’</p>
<p>9、通过&gt;或者&lt;绕过<br>or ‘swords’ &lt; ‘tw’<br>or 1&lt;3</p>
<p>……<br>10、运用注释语句绕过<br>用/<strong>/代替空格，如：<br>UNION /</strong>/ Select /**/user，pwd，from tbluser</p>
<p>用/<strong>/分割敏感词，如：<br>U/</strong>/ NION /<strong>/ SE/</strong>/ LECT /**/user，pwd from tbluser</p>
<p>11、用HEX绕过，一般的IDS都无法检测出来<br>0x640062005F006F0077006E0065007200 =hex(db_owner)</p>
<p>另外，关于通用点的过滤方法，我们可以考虑采用赋值的方法，例如先声明一个变量a，然后把我们的指令赋值给a，然后调用变量a最终执行我们输入的命令。变量a可以是任何命令。如下：<br>declare @a sysname<br>select @a=<br>exec master.dbo.xp_cmdshell @a</p>
<p>效果<br><a href="http://www.ilikeplmm.com/show.asp?id=1;declare%20@a%" target="_blank" rel="noopener">http://www.ilikeplmm.com/show.asp?id=1;declare%20@a%</a> 20sysname%20select%20@a=0x6e006500740020007500730065007200200061006e00670065006c002000700061007300730020002f00610064006400%20exec%20master.dbo.xp_cmdshell%20@a;-</p>
<p>1、运用编码技术绕过<br>如URLEncode编码，ASCII编码绕过。例如or 1=1即%6f%72%20%31%3d%31，而Test也可以为CHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)。</p>
<p>2、通过空格绕过<br>如两个空格代替一个空格，用Tab代替空格等，或者删除所有空格，如<br>or swords =‘swords，由于mssql的松散性，我们可以把or swords 之间的空格去掉，并不影响运行。</p>
<p>3、运用字符串判断代替<br>用经典的or 1=1判断绕过,如or swords =swords，这个方法就是网上在讨论的。</p>
<p>4、通过类型转换修饰符N绕过<br>可以说这是一个不错的想法，他除了能在某种程度上绕过限制，而且还有别的作用，大家自己好好想想吧。关于利用，如or swords = N swords ，大写的N告诉mssql server 字符串作为nvarchar类型，它起到类型转换的作用，并不影响注射语句本身，但是可以避过基于知识的模式匹配IDS。</p>
<p>5、通过+号拆解字符串绕过<br>效果值得考证，但毕竟是一种方法。如or swords =‘sw + ords ；EXEC(‘IN + SERT INTO + ….. )</p>
<p>6、通过LIKE绕过<br>以前怎么就没想到呢？如orswords LIKE sw！！！显然可以很轻松的绕过“=”“&gt;”的限制……</p>
<p>7、通过IN绕过<br>与上面的LIKE的思路差不多,如or swords IN (swords)</p>
<p>8、通过BETWEEN绕过<br>如or swords BETWEEN rw AND tw</p>
<p>9、通过&gt;或者&lt;绕过<br>or swords &gt; sw<br>or swords &lt; tw<br>or 1&lt;3<br>……</p>
<p>10、运用注释语句绕过<br>用/<strong>/代替空格，如：UNION /</strong>/ Select /<strong>/user，pwd，from tbluser<br>用/</strong>/分割敏感词，如：U/<strong>/ NION /</strong>/ SE/<strong>/ LECT /</strong>/user，pwd from tbluser</p>
<p>11、用HEX绕过，一般的IDS都无法检测出来<br>0x730079007300610064006D0069006E00 =hex(sysadmin)<br>0x640062005F006F0077006E0065007200 =hex(db_owner)</p>
<p>12、大小写互换绕过<br>select 可以写成 SelEct<br>union 可以写成 UnIoN</p>
<p>13、多种编码组合绕过<br>常用的有BASE64、ASC、SQL、HEX、URL编码</p>
<p>14、利用中转工具绕过<br>可以利用刺猬的中转工具来绕过</p>
<p>15、利用特殊字符填充绕过<br>这些特殊字符，会被解释成空格，方式和通过空格绕过一样的，一般用来绕过第三方防火墙软件</p>
<dl><dt>16、改变攻击方式<br>如果get提交实在无法绕过，可以尝试改变攻击方式。如；post注入、寻找子站、旁站……等<br>过安全狗：and ‘1’ in(‘1’)<br>空格 - %20<br>“ - %22<br># - %23<br>% - %25<br>&amp; - %26<br>( - %28<br>) - %29<br>+ - %2B<br>, - %2C<br>/ - %2F</dt><dd>- %3A<br>; - %3B<br>&lt; - %3C<br>= - %3D<br>&gt; - %3E<br>? - %3F<br>@ - %40<br>\ - %5C<br>| - %7C</dd></dl><h3 id="渗透大牛思路"><a href="#渗透大牛思路" class="headerlink" title="渗透大牛思路"></a>渗透大牛思路</h3><p>（一）针对网站程序，不考虑服务器。</p>
<p>一、查找注入，注意数据库用户权限和站库是否同服。</p>
<p>二、查找XSS，最近盲打很流行，不管怎样我们的目的是进入后台。</p>
<p>三、查找上传，一些能上传的页面，比如申请友链、会员头像、和一些敏感页面等等，注意查看验证方式是否能绕过，注意结合服务器的解析特性，比如典型的IIS6.0、阿帕奇等。</p>
<p>四、查找编辑器，比较典型的ewebeditor、fckeditor等等。</p>
<p>五、查找phpmyadmin等管理程序，可以尝试弱口令，或者寻找其漏洞。</p>
<p>六、百度、谷歌搜索程序公开漏洞。</p>
<p>七、猜解文件，如知道某文件为admin_login.php,我们可尝试admin_add.php、admin_upload.php文件是否存在，也可以谷歌搜索site:cnseay.com inurl:edit等等，很多时候可以找到一些敏感文件，接着看是否验证权限或能否绕过验证，这像冰风说高级语法。</p>
<p>八、会员注册、修改、删除、评论等一切需要操作数据库的地方记得加单引号之类查看是否存在insert、update等类型注入。</p>
<p>九、会员或低权限管理登陆后可抓包分析，尝试修改超级管理员密码，权限提升。</p>
<p>十、通常有下载功能的站我们可以尝试修改下URL文件名，看能否下载站点敏感文件，如数据库配置文件等，数据库不可外连情况下可以尝试数据库密码登陆后台，也可下载上传、登陆验证等文件进行代码审计。</p>
<p>十一、备份文件和后门，某些主站子目录存在分站，比如<a href="http://www.cnseay.com/seay/，我们可以尝试www.cnseay.com/seay.rar/zip等压缩文件是否存在，可能就是子站的源码。也有一些站类似这样www.cnseay.com/old/，一般都是以前的老站，通常老站会比较容易拿。还有就是数据库备份、前人的后门等，具体这些目录上的东西就要看你的字典了。" target="_blank" rel="noopener">www.cnseay.com/seay/，我们可以尝试www.cnseay.com/seay.rar/zip等压缩文件是否存在，可能就是子站的源码。也有一些站类似这样www.cnseay.com/old/，一般都是以前的老站，通常老站会比较容易拿。还有就是数据库备份、前人的后门等，具体这些目录上的东西就要看你的字典了。</a></p>
<p>十二、0day漏洞，不管是别人给你的，还是自己挖的，总之好使就行。</p>
<p>十三、。。。</p>
<p>（二）针对服务器</p>
<p>一、通常先扫下服务器开放的端口，再考虑对策。</p>
<p>二、比较常见的解析漏洞，比如IIS6.0、阿帕奇、nginx/IIS7.0(php-fpm)解析漏洞等，还有就是cer、asa之类的解析，.htaccess文件解析配置等。</p>
<p>三、弱口令和everyone权限，先扫描服务器开放的端口，比如21对应的FTP、1433对应的MSSQL、3306对应的MYSQL、3389对应的远程桌面、1521对应的Oracle等等，平时可以多搜集下字典，有时候效果也是不错的(通常在cain嗅探的时候，经常能嗅到别人不停的扫…很蛋疼)。</p>
<p>四、溢出，这点要看系统补丁和服务器使用的软件等等，比如FTP等工具，这里不详解。</p>
<p>五、针对一些服务器管理程序，比如tomcat、jboss等等，这种比较常见于大中型的站点服务器。</p>
<p>六、IIS、apache等各种漏洞，这个要平时多关注。</p>
<p>七、目录浏览，服务器配置不当，可直接浏览目录。</p>
<p>八、共享…</p>
<p>九、。。。<br>（三）针对人，社工</p>
<p>社工在渗透中通常能起到惊人的效果，主要还是利用人的弱点，博大精深，这里不详细讨论，注意平时多看一些社工文章，学习一些思路、技巧。</p>
<p>（四）迂回战术，旁注和C段</p>
<p>一、旁注，针对旁站，我们可以运用到上面说到的方法，这里不多说。</p>
<p>二、C段，基本想到C段就会想到cain，针对C段的站点和服务器，结合上面说的针对目标站、服务器、人、旁站的思路，一个道理，当然如果你的目的仅仅是黑站的话，不妨试试NetFuke之类。</p>
<p>三、…<br>（五）提权常用手段</p>
<p>一、使用系统溢出提权EXP，这类在提权中最常用，使用的方法大都一致，比如比较常见的巴西烤肉、pr等等，溢出提权通常在Linux上也利用的比较多，注意多收集EXP。</p>
<p>二、第三方软件提权，主要还是利用服务器上安装的第三方软件拥有比较高的权限，或者软件的溢出漏洞，比如典型的mssql、mysql、serv-u等等，还有各种远程控制软件，比如pcanywhere、Radmin这类。</p>
<p>三、劫持提权，说到这个，想必肯定会想到lpk.dll这类工具，有时候在蛋疼怎么都加不上账户的时候，可以试试劫持shift、添加开机启动等等思路。</p>
<p>四、弱口令技巧，我们可以看看有木有什么hack、或者隐藏账户之类的，一般这种用户密码都比较简单，可以尝试下弱口令，还有之前说过的各种数据库、远程控制软件、FTP软件的弱口令，没办法的时候就去扫扫碰碰运气吧。</p>
<p>五、信息收集，注意翻下硬盘各种文档，说不定各种密码就在里面。在内网渗透时，信息收集是非常重要的，记得拿下服务器了GET一下明文密码，德国那个mimikatz不错，还有就是域、ARP。。。貌似扯多跑题了。</p>
<p>六、社工…不多说。</p>
<h3 id="关于漏洞复现"><a href="#关于漏洞复现" class="headerlink" title="关于漏洞复现"></a>关于漏洞复现</h3><p>cve-2019-0708</p>
<p>通过3389的udp打蓝屏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cve-2019-11043</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;yankaohaitaiwei&#x2F;p&#x2F;11795972.html</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;www.secpulse.com&#x2F;archives&#x2F;117525.html</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1530703</span><br><span class="line"></span><br><span class="line">cve-2019-14287 sudo提权漏洞</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;mark-zh&#x2F;p&#x2F;11679015.html</span><br><span class="line"></span><br><span class="line">cve-2018-13024</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;news&#x2F;193748.html</span><br></pre></td></tr></table></figure>



<h1 id="关于文件隐藏"><a href="#关于文件隐藏" class="headerlink" title="关于文件隐藏"></a>关于文件隐藏</h1><h2 id="驱动级的文件隐藏"><a href="#驱动级的文件隐藏" class="headerlink" title="驱动级的文件隐藏"></a>驱动级的文件隐藏</h2><p>有如下特征：<br>系统目录存在如下文件:<br>c:\WINDOWS\xlkfs.dat<br>c:\WINDOWS\xlkfs.dll<br>c:\WINDOWS\xlkfs.ini<br>c:\WINDOWS\system32\drivers\xlkfs.sys</p>
<p>此驱动级隐藏文件会在服务项增加一个xlkfs的服务<br>驱动文件路径为：c:\WINDOWS\system32\drivers\xlkfs.sys<br>配置文件路径为：c:\WINDOWS\xlkfs.ini（<strong>这里会注明隐藏文件的路径</strong>）</p>
<p><strong>清理：</strong></p>
<p>1、查询服务状态：sc qc xlkfs</p>
<p>2、停止服务：net stop xlkfs</p>
<p>3、删除服务：sc delete xlkfs</p>
<p>4、删除系统目录下面的文件</p>
<p>5、重启系统，确认服务已经被清理了</p>
<h2 id="文件隐藏的部分原理"><a href="#文件隐藏的部分原理" class="headerlink" title="文件隐藏的部分原理"></a>文件隐藏的部分原理</h2><p>常见的文件夹加密方法被我归纳为以下4种：</p>
<ul>
<li><p>利用windows系统特殊的保留文件名后缀，使文件夹无法打开和删除。<br>例如类似1.{20D04FE0-3AEA-1069-A2D8-08002B30309D}等文件夹名称。</p>
</li>
<li><p>利用回收站特点，将文件夹保存在回收站，然后创建创建名为recycle或者RECYCLED的伪回收站。</p>
</li>
<li><p>直接将系统—文件夹的对应关系破坏，<br>在系统中留下一个没有文件实际地址的文件目录，<br>而在加密软件中则保存该文件夹的实际地址。</p>
</li>
<li><p>通过系统驻留程序监控被加密的文件夹，如果需打开，则提示输入密码，而实际上并没有对文件进行加密。</p>
</li>
</ul>
<p>以上<br>第1种方法大概是最常见的方法之一，容易实现，也最容易破解。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">首先是新建文件夹命名为以下名字，再重命名在前面加上xxxx.，即可完成伪装</span><br><span class="line"></span><br><span class="line">现在网上流行的文件夹加密软件比较多,他们其实是将文件夹伪装成系统文件，只需要在要加密的文件夹后面加一个如以下代码的扩展名即可实现。</span><br><span class="line">管理工具</span><br><span class="line">&#123;D20EA4E1-3957-11d2-A40B-0C5020524153&#125;</span><br><span class="line">公文包</span><br><span class="line">&#123;85BBD92O-42A0-1O69-A2E4-08002B30309D&#125;</span><br><span class="line">控制面板</span><br><span class="line">&#123;21EC2O2O-3AEA-1O69-A2DD-08002b30309d&#125;</span><br><span class="line">字体</span><br><span class="line">&#123;D20EA4E1-3957-11d2-A40B-0C5020524152&#125;</span><br><span class="line">历史记录</span><br><span class="line">&#123;FF393560-C2A7-11CF-BFF4-444553540000&#125;</span><br><span class="line">收件箱</span><br><span class="line">&#123;00020D75-0000-0000-C000-000000000046&#125;</span><br><span class="line">Microsoft网络</span><br><span class="line">&#123;00028B00-0000-0000-C000-000000000046&#125;</span><br><span class="line">我的电脑</span><br><span class="line">&#123;20D04FE0-3AEA-1069-A2D8-08002B30309D&#125;</span><br><span class="line">我的文档</span><br><span class="line">&#123;450D8FBA-AD25-11D0-98A8-0800361B1103&#125;</span><br></pre></td></tr></table></figure>

<p>第2种方法也比较容易破解。国内2大著名的加密软件都使用这方法。<br>第3种方法对于不了解原理的人来说应该有一定难度。<br>第4种方法首先要杀死进程才能进一步进行破解。<br>我想如果结合以上第3、4种方法做为家用加密软件还是比较有实用价值的吧…………</p>
<h1 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h1><p>Power是一个功能强大的shell，从面向用户而言，个人觉得其功能强大体现在以下几方面：</p>
<p>（1） 微软态度。微软是真正的在推行PowerShell，包括Office等更多自家软件，底层都是调用PowerShell来实现。</p>
<p>（2） 兼容性cmd。PowerShell包含原先cmd的所有命令，原先命令使用形式不变，在是在其基础上添加命令。</p>
<p>（3） 对标Linux。PowerShell使用了Linux Shell的思想，也就是所有的系统操作、配置，都可以在shell中敲写命令实现。</p>
<p>（4） 统一的命令格式和自包含的文档。</p>
<h2 id="powershell的使用"><a href="#powershell的使用" class="headerlink" title="powershell的使用"></a>powershell的使用</h2><h3 id="启动PowerShell"><a href="#启动PowerShell" class="headerlink" title="启动PowerShell"></a>启动PowerShell</h3><p>方法一： 直接在cmd中执行powershell，切换为powershell</p>
<p>方法二： 开始菜单中输入powershell启动powershell</p>
<p>方法三： 开始菜单—-附件—-powershell启动</p>
<p>带x86的是32位的，不带的是64位的；带ies的是简单的ide</p>
<h3 id="使用powershell"><a href="#使用powershell" class="headerlink" title="使用powershell"></a>使用powershell</h3><ul>
<li><p>get-help查看帮助（get-help 想要获取帮助的命令）</p>
</li>
<li><p>get-command查看有哪些命令</p>
<ul>
<li>CommandType列，表示命令类型，Alias是别名、Cmdlet是powershell格式的命令、Function是函数</li>
<li>Name列，就是命令</li>
<li>Definition列，命令功能的简单描述</li>
</ul>
</li>
<li><p>get-command缩小范围</p>
<ul>
<li>get-command get-*列出了所有get开头的命令</li>
<li>get-process的命令，获取进程信息的，get-process -name *typora</li>
</ul>
</li>
<li><p>stop-process -id pid杀除命令</p>
</li>
</ul>
<h2 id="powershell的命令"><a href="#powershell的命令" class="headerlink" title="powershell的命令"></a>powershell的命令</h2><p>　<strong>入门级别</strong></p>
<p>　　1. 像文件系统那样操作Windows Registry——cd hkcu:（切换到注册表）<br>　　2. 在文件里递回地搜索某个字符串——dir –r | select string “searchforthis”<br>　　3. 使用内存找到五个进程——ps | sort –p ws | select –last 5<br>　　4. 循环（停止，然后重启）一个服务，如DHCP——Restart-Service DHCP<br>　　5. 在文件夹里列出所有条目——Get-ChildItem – Force<br>　　6. 递归一系列的目录或文件夹——Get-ChildItem –Force c:\directory –Recurse<br>　　7. 在目录里移除所有文件而不需要单个移除——Remove-Item C:\tobedeleted –Recurse<br>  8. 重启当前计算机——(Get-WmiObject -Class Win32_OperatingSystem -ComputerName .).Win32Shutdown(2)</p>
<pre><code>**收集信息**</code></pre><ol start="9">
<li>获取计算机组成或模型信息——Get-WmiObject -Class Win32_ComputerSystem</li>
<li>获取当前计算机的BIOS信息——Get-WmiObject -Class Win32_BIOS -ComputerName .</li>
<li>列出所安装的修复程序（如QFE或Windows Update文件）——Get-WmiObject -Class Win32_QuickFixEngineering -ComputerName .</li>
<li>获取当前登录计算机的用户的用户名—— Get-WmiObject -Class Win32_ComputerSystem -Property UserName -ComputerName .</li>
<li>获取当前计算机所安装的应用的名字——Get-WmiObject -Class Win32_Product -ComputerName . | Format-Wide -Column 1</li>
<li>获取分配给当前计算机的IP地址——Get-WmiObject -Class Win32_NetworkAdapterConfiguration -Filter IPEnabled=TRUE -ComputerName . | Format-Table -Property IPAddress</li>
<li>获取当前机器详细的IP配置报道——Get-WmiObject -Class Win32_NetworkAdapterConfiguration -Filter IPEnabled=TRUE -ComputerName . | Select-Object -Property [a-z]* -ExcludeProperty IPX<em>,WINS</em></li>
<li>找到当前计算机上使用DHCP启用的网络卡——Get-WmiObject -Class Win32_NetworkAdapterConfiguration -Filter “DHCPEnabled=true” -ComputerName .</li>
<li>在当前计算机上的所有网络适配器上启用DHCP——Get-WmiObject -Class Win32_NetworkAdapterConfiguration -Filter IPEnabled=true -ComputerName . | ForEach-Object -Process {$_.EnableDHCP()}</li>
</ol>
<p>　　<strong>软件管理</strong></p>
<p>　　18. 在远程计算机上安装MSI包——(Get-WMIObject -ComputerName TARGETMACHINE -List | Where-Object -FilterScript {$_.Name -eq “Win32_Product”}).Install(\MACHINEWHEREMSIRESIDES\path\package.msi)<br>　　19. 使用基于MSI的应用升级包升级所安装的应用——(Get-WmiObject -Class Win32_Product -ComputerName . -Filter “Name=’name_of_app_to_be_upgraded’”).Upgrade(\MACHINEWHEREMSIRESIDES\path\upgrade_package.msi)<br>　　20. 从当前计算机移除MSI包——(Get-WmiObject -Class Win32_Product -Filter “Name=’product_to_remove’” -ComputerName . ).Uninstall()<br>　　机器管理<br>　　21. 一分钟后远程关闭另一台机器——Start-Sleep 60; Restart-Computer –Force –ComputerName TARGETMACHINE<br>　　22. 添加打印机——(New-Object -ComObject WScript.Network).AddWindowsPrinterConnection(\printerserver\hplaser3)<br>　　23. 移除打印机——(New-Object -ComObject WScript.Network).RemovePrinterConnection(“\printerserver\hplaser3 “)<br>　　24. 进入PowerShell会话——invoke-command -computername machine1, machine2 -filepath c:\Script\script.ps1</p>
<h2 id="powershell渗透工具"><a href="#powershell渗透工具" class="headerlink" title="powershell渗透工具"></a>powershell渗透工具</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">nishang</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;m0_37438418&#x2F;article&#x2F;details&#x2F;80327624</span><br><span class="line"></span><br><span class="line">Empire	PowerShell后期漏洞利用代理工具</span><br><span class="line">不多说 给链接 实战中有时候比msf更好用</span><br><span class="line">http:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;76892.html</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;EmpireProject&#x2F;Empire</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;a1453514850&#x2F;article&#x2F;details&#x2F;88102779</span><br><span class="line"></span><br><span class="line">绕过PowerShell Execution Policy</span><br><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;system&#x2F;93829.html</span><br><span class="line"></span><br><span class="line">PowerSploit上面有很多powershell攻击脚本，它们主要被用来渗透中的信息侦察、权限提升、权限维持。</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;PowerShellMafia&#x2F;PowerSploit</span><br><span class="line">具体利用</span><br><span class="line">https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;263</span><br><span class="line">https:&#x2F;&#x2F;www.secpulse.com&#x2F;archives&#x2F;55893.html</span><br><span class="line"></span><br><span class="line">其它姿势</span><br><span class="line">http:&#x2F;&#x2F;www.freebuf.com&#x2F;sectool&#x2F;90362.html</span><br><span class="line">http:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;system&#x2F;133640.html</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">powershell取证</span><br><span class="line">http:&#x2F;&#x2F;bobao.360.cn&#x2F;learning&#x2F;detail&#x2F;570.html</span><br><span class="line"></span><br><span class="line">powershell对日志分析</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;xiaozi&#x2F;p&#x2F;9284138.html</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/31/%E7%AC%AC%E4%B8%89%E5%91%A8/12.31/" data-id="ck5kmexjr0003k0tw7u6m4iic" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第三周/12.30" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/30/%E7%AC%AC%E4%B8%89%E5%91%A8/12.30/" class="article-date">
  <time datetime="2019-12-30T02:04:03.663Z" itemprop="datePublished">2019-12-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/30/%E7%AC%AC%E4%B8%89%E5%91%A8/12.30/">第三周/12.30</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="常见的可执行文件格式"><a href="#常见的可执行文件格式" class="headerlink" title="常见的可执行文件格式"></a>常见的可执行文件格式</h1><p>exe、dll、sys、com、bat、cmd、scr、pif、reg、txt等等</p>
<p>查看-PCHounter-系统杂项-文件关联</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">工具链接</span><br><span class="line">https:&#x2F;&#x2F;down.52pojie.cn&#x2F;Tools&#x2F;Anti_Rootkit&#x2F;</span><br></pre></td></tr></table></figure>

<p><strong>可执行文件的文件格式常见有：</strong><br><strong>exe 和 dll（Windows 系列）、elf（Linux 系列）和 Mach-O（Mac系列）</strong></p>
<h2 id="DLL与EXE"><a href="#DLL与EXE" class="headerlink" title="DLL与EXE"></a>DLL与EXE</h2><h3 id="DLL概念"><a href="#DLL概念" class="headerlink" title="DLL概念"></a>DLL概念</h3><p>DLL中虽然包含了可执行代码却不能单独执行，而应由Windows应用程序直接或间接调用。</p>
<p>就相当于python调用的模块，<strong>DLL将程序代码封装成函数</strong></p>
<p>DLL和EXE文件一样，其中包含的也是程序的代码和程序所需的资源(比如图标、对话框、字符串等)</p>
<p>DLL中的代码是以 API函数形式出现的，通俗地说，DLL中包含的程序代码都被做成了一个个小模块，应用程序通过按下所需DLL中特定的按钮，来调用DLL中这个按钮所代表的功能</p>
<h3 id="系统中重要的DLL"><a href="#系统中重要的DLL" class="headerlink" title="系统中重要的DLL"></a>系统中重要的DLL</h3><p>其中Windows系统有三个重要的DLL：Kernel32.dll（内核相关）、User32.dll（用户相关）、 GDI32.dll（图形设备接口相关）</p>
<h3 id="为什么写DLL？"><a href="#为什么写DLL？" class="headerlink" title="为什么写DLL？"></a>为什么写DLL？</h3><ul>
<li>方便扩展</li>
<li>便于合作</li>
<li>节省内存</li>
</ul>
<p>分析EXE文件的工具Dependency Walker</p>
<h1 id="常见的木马启动方式"><a href="#常见的木马启动方式" class="headerlink" title="常见的木马启动方式"></a>常见的木马启动方式</h1><h2 id="通过”开始程序启动”"><a href="#通过”开始程序启动”" class="headerlink" title="通过”开始程序启动”"></a>通过”开始程序启动”</h2><p>msconfig就可以查看</p>
<h2 id="通过win-ini"><a href="#通过win-ini" class="headerlink" title="通过win.ini"></a>通过win.ini</h2><p>同启动组一样</p>
<h2 id="通过注册表启动"><a href="#通过注册表启动" class="headerlink" title="通过注册表启动"></a>通过注册表启动</h2><p>HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRun等等</p>
<p>木马可以在自身加一个时间控件，以便实时监视注册表中自身的启动键值是否存在，一旦发现被删除，则立即重新写入，以保证下次Windows启动时自己能被运行。这样木马程序和注册表中的启动键值之间形成了一种互相保护的状态。</p>
<p>安全模式启动Windows，这时，Windows不会加载注册表中的项目</p>
<p>部分注册表它的内容不会出现在msconfig中，比如</p>
<p>HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRunOnce和HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRunOnce和HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRunServicesOnce</p>
<p>1 注册表 CurrentUser \ SoftWare \ Microsoft \ Windows \ CurrentVersion \ 下的所有run有关的子键<br>2 注册表 LocalMachine \ SoftWare \ Microsoft \ Windows \ CurrentVersion \ 下的所有run有关的子键<br>3 注册表 CurrentUser \ SoftWare \ Microsoft \ Windows NT \ CurrentVersion \ 键名为load的字符型数据<br>4 注册表 LocalMachine \ SoftWare \ Microsoft \ Windows NT \ CurrentVersion \ 键名为load的字符型数据</p>
<p>注册表的值%1%*</p>
<p>%1是输入参数。举个例子来说：<br>右键某些文本类型的文件(如a.bat)时，会有一个”编辑”选项。这个选项对应的注册表里面的命令为%SystemRoot%\notepad.exe %1<br>那么当你单击”编辑”时，上面的命令就会执行。执行的顺序为：首先打开记事本软件%SystemRoot%\notepad.exe；然后，再将a.bat作为参数传递给notepad.exe。这样子的结果就是：用记事本打开了a.bat<br>这个%1此时代表的就是a.bat了，即你操作的那个文件</p>
<h2 id="通过Autoexec-bat、winstart-bat、config-sys文件"><a href="#通过Autoexec-bat、winstart-bat、config-sys文件" class="headerlink" title="通过Autoexec.bat、winstart.bat、config.sys文件 　"></a>通过Autoexec.bat、winstart.bat、config.sys文件 　</h2><p>其实这种方法并不适合木马使用，因为该文件会在Windows启动前运行，这时系统处于DOS环境，只能运行16位应用程序，Windows下的32位程序是不能运行的。因此也就失去了木马的意义。不过，这并不是说它不能用于启动木马。可以想象，SoftIce for Win98（功能强大的程序调试工具，被黑客奉为至宝，常用于破解应用程序）也是先要在Autoexec.bat文件中运行然后才能在Windows中呼叫出窗口，进行调试的，既然如此，谁能保证木马不会这样启动呢？到目前为止，我还没见过这样启动的木马，我想能写这样木马的人一定是高手中的高手了。 　　</p>
<p>另外，这两个BAT文件常被用于破坏，它们会在这个文件中加入类似”Deltree C：<em>.</em>“和”Format C：/u”的行，这样，在你启动计算机后还未启动Windows，你的C盘已然空空如也。</p>
<h2 id="通过System-ini文件"><a href="#通过System-ini文件" class="headerlink" title="通过System.ini文件"></a>通过System.ini文件</h2><p>事实上，System.ini文件并没有给用户可用的启动项目，然而通过它启动却是非常好用的。在System.ini文件的[Boot]域中的Shell项的值正常情况下是”Explorer.exe”，这是Windows的外壳程序，换一个程序就可以彻底改变Windows的面貌（如改为Progman.exe就可以让Win9x变成Windows3.2）。我们可以在”Explorer.exe”后加上木马程序的路径，这样Windows启动后木马也就随之启动，而且即使是安全模式启动也不会跳过这一项，这样木马也就可以保证永远随Windows启动了</p>
<p>类似于强制绑定首页，会在浏览器的快捷方式后面加上首页的地址</p>
<h2 id="通过服务加载"><a href="#通过服务加载" class="headerlink" title="通过服务加载"></a>通过服务加载</h2><p>系统要正常的运行，就少不了一些服务，一些木马通过加载服务来达到随系统启动的目的</p>
<p>控制面板——–管理工具——服务</p>
<p>通过 net start 服务名(开启服务)    net stop 服务名(关闭服务)</p>
<h2 id="通过某特定程序或文件启动"><a href="#通过某特定程序或文件启动" class="headerlink" title="通过某特定程序或文件启动"></a>通过某特定程序或文件启动</h2><h3 id="寄生于特定程序之中"><a href="#寄生于特定程序之中" class="headerlink" title="寄生于特定程序之中"></a>寄生于特定程序之中</h3><p>即木马和正常程序捆绑，有点类似于病毒，程序在运行时，木马程序先获得控制权或另开一个线程以监视用户操作，截取密码等，这类木马编写的难度较大，需要了解PE文件结构和Windows的底层知识（直接使用捆绑程序除外）。 </p>
<p>捆绑和关联文件不同，关联是修改注册表，但捆绑类似于病毒的“感染”，就是把木马的进程感染到其他的执行文件上，业内著名木马“网络公牛 - Netbu ll”就是利用这种方法进行启动。<br>　　网络公牛服务端名称newserver.exe,运行后自动脱壳到c:\windows\system\checkdll.exe目录下，下次开机自动运行,同时服务端在运行时会自动捆绑以下文件：<br>　　win9x: notepad.exe write.exe regedit.exe winmine.exe winhelp.exe<br>　　winnt: notepad.exe regedit.exe reged32.exe drwtsn32.exe winmine.exe<br>　　并且自动搜索系统启动项程序，捆绑之。比如qq.exe realplay.exe<br>　　除非把以上文件全部删除，否则无法清除，但系统文件删除后系统就无法正常运行，所以大多数人只能重装系统。确实牛。</p>
<h3 id="将特定的程序改名"><a href="#将特定的程序改名" class="headerlink" title="将特定的程序改名"></a>将特定的程序改名</h3><p>这种方式常见于针对QQ的木马，例如将QQ的启动文件QQ2000b.exe，改为QQ2000b.ico.exe（Windows默认是不显示扩展名的，因此它会被显示为QQ2000b.ico，而用户会认为它是一个图标），再将木马程序改为QQ2000b.exe，此后，用户运行QQ，实际是运行了QQ木马，再由QQ木马去启动真正的QQ，这种方式实现起来要比上一种简单的多。</p>
<h3 id="文件关联"><a href="#文件关联" class="headerlink" title="文件关联"></a>文件关联</h3><p>通常木马程序会将自己和TXT文件或EXE文件关联，这样当你打开一个文本文件或运行一个程序时，木马也就神不知鬼不觉的启动了。 　　</p>
<p>这类通过特定程序或文件启动的木马，发现比较困难，但查杀并不难。一般地，只要删除相应的文件和注册表键值即可。</p>
<p>在业内著名的木马冰河就是这样启动的，它关联的是exe类型的文件，方法如下：(以下方法是我在我的win2003中测试通过的)</p>
<p>注册表 ClassRoot 下的.exe 文件打开方式为exefile，我们就找到exefile子键，然后exefile该键下有一个shell子键，在shell子键下有open子键，在open下有command子键，command里有default键,value为”%1” %* 我们把它改变为 木马路径 “%1” %* 就可以了</p>
<h3 id="通过进程保护"><a href="#通过进程保护" class="headerlink" title="通过进程保护"></a>通过进程保护</h3><p>　　两个木马进程，互相监视，发现对方被关闭后启动对方。技术其实不神秘，方法如下：<br>　　while (true)<br>　　{System.Threading.Thread.Sleep(500);//检查对方进程是否关闭，关闭的话再打开。}</p>
<h3 id="通过启动文件夹"><a href="#通过启动文件夹" class="headerlink" title="通过启动文件夹"></a>通过启动文件夹</h3><p>　　开始菜单的启动文件夹内的文件在系统启动后会随系统启动，假如将一个exe文件或exe文件的快捷方式复制到启动文件夹内，太明显，但设置隐藏属性后不会被系统启动。<br>　　有一个办法，将启动文件夹改名为启动a,并将该文件隐藏，然后再新建一个启动文件夹，将原启动文件夹内的所有内容复制到新建的启动文件夹，这样就可以了。(其实系统还是会启动原来的启动文件夹内的内rogn，也就是现在被改为”启动a”的文件夹，而现在我们新建的”启动”文件夹只是一个摆设而已，因为在这里的”启动a”对应着注册表local_machine\software\microsoft\windows\currentversion\explorer\startmenu内的common startup键值，当我们更该原来系统的启动文件夹的名字为”启动a”的时候该键值也会变为:\Documents and Settings\All Users\开始\Programs\启动a”)<br>　　另外可在local_machine\software\microsoft\windows\currentversion下建立RunServices子键来实现自启动，和run不同，run是系统启动后加载,runservices是系统登录时就启动<br>　　在系统根目录下放置Explorer.exe文件，在Explorer.exe文件中去启动正常的Explorer.exe文件，可以在C盘和D盘下都放上。</p>
<h1 id="PE文件"><a href="#PE文件" class="headerlink" title="PE文件"></a>PE文件</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>PE（Portable Execute）文件是Windows下可执行文件的总称，常见的有DLL，EXE，OCX，SYS等，事实上，一个文件是否是PE文件与其扩展名无关，PE文件可以是任何扩展名。那Windows是怎么区分可执行文件和非可执行文件的呢？我们调用LoadLibrary传递了一个文件名，系统是如何判断这个文件是一个合法的动态库呢？这就涉及到PE文件结构了。</p>
<h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><p>PE文件的结构一般来说：从起始位置开始依次是DOS头，NT头，节表以及具体的节。</p>
<h3 id="DOS头"><a href="#DOS头" class="headerlink" title="DOS头"></a>DOS头</h3><p>DOS头是用来兼容MS-DOS操作系统的，目的是当这个文件在MS-DOS上运行时提示一段文字，大部分情况下是：<strong>This program cannot be run in DOS mode</strong>，还有一个目的，就是指明NT头在文件中的位置。（利用winhex查看exe、dll文件，确实有那句话）</p>
<p>e_magic：一个WORD类型，值是一个常数0x4D5A，用文本编辑器查看该值位‘MZ’，<strong>可执行文件必须都是’MZ’开头</strong>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/30/%E7%AC%AC%E4%B8%89%E5%91%A8/12.30/" data-id="ck5kmexjq0002k0twa9x91z9d" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.9/">第四周/1.9</a>
          </li>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.8/">第四周/1.8</a>
          </li>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.7/">第四周/1.7</a>
          </li>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.6/">第四周/1.6</a>
          </li>
        
          <li>
            <a href="/2020/01/19/%E7%AC%AC%E5%9B%9B%E5%91%A8/1.10/">第四周/1.10</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 熊猫在路上<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>